// The MIT License (MIT)
//
// Copyright (c) 2018 PubNative GmbH
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
//
package net.pubnative.lite.sdk.mraid;

import android.content.res.Resources;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.drawable.BitmapDrawable;
import android.graphics.drawable.Drawable;
import android.util.Base64;

/**
 * Created by erosgarciaponte on 08.01.18.
 */

public class Assets {
    /*
     * To add a new assets, convert the asset (js or jpg or png) to a base64 string, use an online tool to remove the
     * new line characters, then add the string here.
     */

    public static final String mraidJS = "Ly8KLy8gIG1yYWlkLmpzCi8vCgooZnVuY3Rpb24oKSB7CgkKCWNvbnNvbGUubG9nKCJNUkFJRCBvYmplY3QgbG9hZGluZy4uLiIpOwoKCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCSAqIGNvbnNvbGUgbG9nZ2luZyBoZWxwZXIKCSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgl2YXIgTG9nTGV2ZWxFbnVtID0gewoJCSJERUJVRyIgICA6IDAsCgkJIklORk8iICAgIDogMSwKCQkiV0FSTklORyIgOiAyLAoJCSJFUlJPUiIgICA6IDMsCgkJIk5PTkUiICAgIDogNAoJfTsKCgl2YXIgbG9nTGV2ZWwgPSBMb2dMZXZlbEVudW0uREVCVUc7Cgl2YXIgbG9nID0ge307CgoJbG9nLmQgPSBmdW5jdGlvbihtc2cpIHsKCQlpZiAobG9nTGV2ZWwgPD0gTG9nTGV2ZWxFbnVtLkRFQlVHKSB7CgkJCWNvbnNvbGUubG9nKCIoRC1tcmFpZC5qcykgIiArIG1zZyk7CgkJfQoJfTsKCglsb2cuaSA9IGZ1bmN0aW9uKG1zZykgewoJCWlmIChsb2dMZXZlbCA8PSBMb2dMZXZlbEVudW0uSU5GTykgewoJCQljb25zb2xlLmxvZygiKEktbXJhaWQuanMpICIgKyBtc2cpOwoJCX0KCX07CgoJbG9nLncgPSBmdW5jdGlvbihtc2cpIHsKCQlpZiAobG9nTGV2ZWwgPD0gTG9nTGV2ZWxFbnVtLldBUk5JTkcpIHsKCQkJY29uc29sZS5sb2coIihXLW1yYWlkLmpzKSAiICsgbXNnKTsKCQl9Cgl9OwoKCWxvZy5lID0gZnVuY3Rpb24obXNnKSB7CgkJaWYgKGxvZ0xldmVsIDw9IExvZ0xldmVsRW51bS5FUlJPUikgewoJCQljb25zb2xlLmxvZygiKEUtbXJhaWQuanMpICIgKyBtc2cpOwoJCX0KCX07CgoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoJICogTVJBSUQgZGVjbGFyYXRpb24KCSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgl2YXIgbXJhaWQgPSB3aW5kb3cubXJhaWQgPSB7fTsKCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgkgKiBjb25zdGFudHMKCSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgl2YXIgVkVSU0lPTiA9ICIyLjAiOwoKCXZhciBTVEFURVMgPSBtcmFpZC5TVEFURVMgPSB7CgkJIkxPQURJTkciIDogImxvYWRpbmciLAoJCSJERUZBVUxUIiA6ICJkZWZhdWx0IiwKCQkiRVhQQU5ERUQiIDogImV4cGFuZGVkIiwKCQkiUkVTSVpFRCIgOiAicmVzaXplZCIsCgkJIkhJRERFTiIgOiAiaGlkZGVuIgoJfTsKCgl2YXIgUExBQ0VNRU5UX1RZUEVTID0gbXJhaWQuUExBQ0VNRU5UX1RZUEVTID0gewoJCSJJTkxJTkUiIDogImlubGluZSIsCgkJIklOVEVSU1RJVElBTCIgOiAiaW50ZXJzdGl0aWFsIgoJfTsKCgl2YXIgUkVTSVpFX1BST1BFUlRJRVNfQ1VTVE9NX0NMT1NFX1BPU0lUSU9OID0gbXJhaWQuUkVTSVpFX1BST1BFUlRJRVNfQ1VTVE9NX0NMT1NFX1BPU0lUSU9OID0gewoJCSJUT1BfTEVGVCIgOiAidG9wLWxlZnQiLAoJCSJUT1BfQ0VOVEVSIiA6ICJ0b3AtY2VudGVyIiwKCQkiVE9QX1JJR0hUIiA6ICJ0b3AtcmlnaHQiLAoJCSJDRU5URVIiIDogImNlbnRlciIsCgkJIkJPVFRPTV9MRUZUIiA6ICJib3R0b20tbGVmdCIsCgkJIkJPVFRPTV9DRU5URVIiIDogImJvdHRvbS1jZW50ZXIiLAoJCSJCT1RUT01fUklHSFQiIDogImJvdHRvbS1yaWdodCIKCX07CgoJdmFyIE9SSUVOVEFUSU9OX1BST1BFUlRJRVNfRk9SQ0VfT1JJRU5UQVRJT04gPSBtcmFpZC5PUklFTlRBVElPTl9QUk9QRVJUSUVTX0ZPUkNFX09SSUVOVEFUSU9OID0gewoJCSJQT1JUUkFJVCIgOiAicG9ydHJhaXQiLAoJCSJMQU5EU0NBUEUiIDogImxhbmRzY2FwZSIsCgkJIk5PTkUiIDogIm5vbmUiCgl9OwoKCXZhciBFVkVOVFMgPSBtcmFpZC5FVkVOVFMgPSB7CgkJIkVSUk9SIiA6ICJlcnJvciIsCgkJIlJFQURZIiA6ICJyZWFkeSIsCgkJIlNJWkVDSEFOR0UiIDogInNpemVDaGFuZ2UiLAoJCSJTVEFURUNIQU5HRSIgOiAic3RhdGVDaGFuZ2UiLAoJCSJWSUVXQUJMRUNIQU5HRSIgOiAidmlld2FibGVDaGFuZ2UiCgl9OwoKCXZhciBTVVBQT1JURURfRkVBVFVSRVMgPSBtcmFpZC5TVVBQT1JURURfRkVBVFVSRVMgPSB7CgkJIlNNUyIgOiAic21zIiwKCQkiVEVMIiA6ICJ0ZWwiLAoJCSJDQUxFTkRBUiIgOiAiY2FsZW5kYXIiLAoJCSJTVE9SRVBJQ1RVUkUiIDogInN0b3JlUGljdHVyZSIsCgkJIklOTElORVZJREVPIiA6ICJpbmxpbmVWaWRlbyIKCX07CgoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoJICogc3RhdGUKCSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgl2YXIgc3RhdGUgPSBTVEFURVMuTE9BRElORzsKCXZhciBwbGFjZW1lbnRUeXBlID0gUExBQ0VNRU5UX1RZUEVTLklOTElORTsKCXZhciBzdXBwb3J0ZWRGZWF0dXJlcyA9IHt9OwoJdmFyIGlzVmlld2FibGUgPSBmYWxzZTsKCXZhciBpc0V4cGFuZFByb3BlcnRpZXNTZXQgPSBmYWxzZTsKCXZhciBpc1Jlc2l6ZVJlYWR5ID0gZmFsc2U7CgoJdmFyIGV4cGFuZFByb3BlcnRpZXMgPSB7CgkJIndpZHRoIiA6IDAsCgkJImhlaWdodCIgOiAwLAoJCSJ1c2VDdXN0b21DbG9zZSIgOiBmYWxzZSwKCQkiaXNNb2RhbCIgOiB0cnVlCgl9OwoKCXZhciBvcmllbnRhdGlvblByb3BlcnRpZXMgPSB7CgkJImFsbG93T3JpZW50YXRpb25DaGFuZ2UiIDogdHJ1ZSwKCQkiZm9yY2VPcmllbnRhdGlvbiIgOiBPUklFTlRBVElPTl9QUk9QRVJUSUVTX0ZPUkNFX09SSUVOVEFUSU9OLk5PTkUKCX07CgoJdmFyIHJlc2l6ZVByb3BlcnRpZXMgPSB7CgkJIndpZHRoIiA6IDAsCgkJImhlaWdodCIgOiAwLAoJCSJjdXN0b21DbG9zZVBvc2l0aW9uIiA6IFJFU0laRV9QUk9QRVJUSUVTX0NVU1RPTV9DTE9TRV9QT1NJVElPTi5UT1BfUklHSFQsCgkJIm9mZnNldFgiIDogMCwKCQkib2Zmc2V0WSIgOiAwLAoJCSJhbGxvd09mZnNjcmVlbiIgOiB0cnVlCgl9OwoKCXZhciBjdXJyZW50UG9zaXRpb24gPSB7CgkJIngiIDogMCwKCQkieSIgOiAwLAoJCSJ3aWR0aCIgOiAwLAoJCSJoZWlnaHQiIDogMAoJfTsKCgl2YXIgZGVmYXVsdFBvc2l0aW9uID0gewoJCSJ4IiA6IDAsCgkJInkiIDogMCwKCQkid2lkdGgiIDogMCwKCQkiaGVpZ2h0IiA6IDAKCX07CgoJdmFyIG1heFNpemUgPSB7CgkJIndpZHRoIiA6IDAsCgkJImhlaWdodCIgOiAwCgl9OwoKCXZhciBzY3JlZW5TaXplID0gewoJCSJ3aWR0aCIgOiAwLAoJCSJoZWlnaHQiIDogMAoJfTsKCgl2YXIgY3VycmVudE9yaWVudGF0aW9uID0gMDsKCgl2YXIgbGlzdGVuZXJzID0ge307Cgl3aW5kb3cubGlzdGVuZXJzID0gbGlzdGVuZXJzOwoKCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCSAqICJvZmZpY2lhbCIgQVBJOiBtZXRob2RzIGNhbGxlZCBieSBjcmVhdGl2ZQoJICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCW1yYWlkLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgbGlzdGVuZXIpIHsKCQlsb2cuaSgibXJhaWQuYWRkRXZlbnRMaXN0ZW5lciAiICsgZXZlbnQgKyAiOiAiICsgU3RyaW5nKGxpc3RlbmVyKSk7CgkJaWYgKCFldmVudCB8fCAhbGlzdGVuZXIpIHsKCQkJbXJhaWQuZmlyZUVycm9yRXZlbnQoIkJvdGggZXZlbnQgYW5kIGxpc3RlbmVyIGFyZSByZXF1aXJlZC4iLCAiYWRkRXZlbnRMaXN0ZW5lciIpOwoJCQlyZXR1cm47CgkJfQoJCWlmICghY29udGFpbnMoZXZlbnQsIEVWRU5UUykpIHsKCQkJbXJhaWQuZmlyZUVycm9yRXZlbnQoIlVua25vd24gTVJBSUQgZXZlbnQ6ICIgKyBldmVudCwgImFkZEV2ZW50TGlzdGVuZXIiKTsKCQkJcmV0dXJuOwoJCX0KCQl2YXIgbGlzdGVuZXJzRm9yRXZlbnQgPSBsaXN0ZW5lcnNbZXZlbnRdID0gbGlzdGVuZXJzW2V2ZW50XSB8fCBbXTsKCQkvLyBjaGVjayB0byBtYWtlIHN1cmUgdGhhdCB0aGUgbGlzdGVuZXIgaXNuJ3QgYWxyZWFkeSByZWdpc3RlcmVkCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7IGkrKykgewoJCQl2YXIgc3RyMSA9IFN0cmluZyhsaXN0ZW5lcik7CgkJCXZhciBzdHIyID0gU3RyaW5nKGxpc3RlbmVyc0ZvckV2ZW50W2ldKTsKCQkJaWYgKGxpc3RlbmVyID09PSBsaXN0ZW5lcnNGb3JFdmVudFtpXSB8fCBzdHIxID09PSBzdHIyKSB7CgkJCQlsb2cuaSgibGlzdGVuZXIgIiArIHN0cjEgKyAiIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCBmb3IgZXZlbnQgIiArIGV2ZW50KTsKCQkJCXJldHVybjsKCQkJfQoJCX0KCQlsaXN0ZW5lcnNGb3JFdmVudC5wdXNoKGxpc3RlbmVyKTsKCX07CgoJbXJhaWQuY3JlYXRlQ2FsZW5kYXJFdmVudCA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHsKCQlsb2cuaSgibXJhaWQuY3JlYXRlQ2FsZW5kYXJFdmVudCB3aXRoICIgKyBwYXJhbWV0ZXJzKTsKCQlpZiAoc3VwcG9ydGVkRmVhdHVyZXNbbXJhaWQuU1VQUE9SVEVEX0ZFQVRVUkVTLkNBTEVOREFSXSkgewoJCQljYWxsTmF0aXZlKCJjcmVhdGVDYWxlbmRhckV2ZW50P2V2ZW50SlNPTj0iCSsgSlNPTi5zdHJpbmdpZnkocGFyYW1ldGVycykpOwoJCX0gZWxzZSB7CgkJCWxvZy5lKCJjcmVhdGVDYWxlbmRhckV2ZW50IGlzIG5vdCBzdXBwb3J0ZWQiKTsKCQl9Cgl9OwoKCW1yYWlkLmNsb3NlID0gZnVuY3Rpb24oKSB7CgkJbG9nLmkoIm1yYWlkLmNsb3NlIik7CgkJaWYgKHN0YXRlID09PSBTVEFURVMuTE9BRElORwoJCQkJfHwgKHN0YXRlID09PSBTVEFURVMuREVGQVVMVCAmJiBwbGFjZW1lbnRUeXBlID09PSBQTEFDRU1FTlRfVFlQRVMuSU5MSU5FKQoJCQkJfHwgc3RhdGUgPT09IFNUQVRFUy5ISURERU4pIHsKCQkJLy8gZG8gbm90aGluZwoJCQlyZXR1cm47CgkJfQoJCWNhbGxOYXRpdmUoImNsb3NlIik7Cgl9OwoKCW1yYWlkLmV4cGFuZCA9IGZ1bmN0aW9uKHVybCkgewoJCWlmICh1cmwgPT09IHVuZGVmaW5lZCkgewoJCQlsb2cuaSgibXJhaWQuZXhwYW5kICgxLXBhcnQpIik7CgkJfSBlbHNlIHsKCQkJbG9nLmkoIm1yYWlkLmV4cGFuZCAiICsgdXJsKTsKCQl9CgkJLy8gVGhlIG9ubHkgdGltZSBpdCBpcyB2YWxpZCB0byBjYWxsIGV4cGFuZCBpcyB3aGVuIHRoZSBhZCBpcwoJCS8vIGEgYmFubmVyIGN1cnJlbnRseSBpbiBlaXRoZXIgZGVmYXVsdCBvciByZXNpemVkIHN0YXRlLgoJCWlmIChwbGFjZW1lbnRUeXBlICE9PSBQTEFDRU1FTlRfVFlQRVMuSU5MSU5FCgkJCQl8fCAoc3RhdGUgIT09IFNUQVRFUy5ERUZBVUxUICYmIHN0YXRlICE9PSBTVEFURVMuUkVTSVpFRCkpIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAodXJsID09PSB1bmRlZmluZWQpIHsKCQkJY2FsbE5hdGl2ZSgiZXhwYW5kIik7CgkJfSBlbHNlIHsKCQkJY2FsbE5hdGl2ZSgiZXhwYW5kP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwoJCX0KCX07CgoJbXJhaWQuZ2V0Q3VycmVudFBvc2l0aW9uID0gZnVuY3Rpb24oKSB7CgkJbG9nLmkoIm1yYWlkLmdldEN1cnJlbnRQb3NpdGlvbiIpOwoJCXJldHVybiBjdXJyZW50UG9zaXRpb247Cgl9OwoKCW1yYWlkLmdldERlZmF1bHRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkgewoJCWxvZy5pKCJtcmFpZC5nZXREZWZhdWx0UG9zaXRpb24iKTsKCQlyZXR1cm4gZGVmYXVsdFBvc2l0aW9uOwoJfTsKCgltcmFpZC5nZXRFeHBhbmRQcm9wZXJ0aWVzID0gZnVuY3Rpb24oKSB7CgkJbG9nLmkoIm1yYWlkLmdldEV4cGFuZFByb3BlcnRpZXMiKTsKCQlyZXR1cm4gZXhwYW5kUHJvcGVydGllczsKCX07CgoJbXJhaWQuZ2V0TWF4U2l6ZSA9IGZ1bmN0aW9uKCkgewoJCWxvZy5pKCJtcmFpZC5nZXRNYXhTaXplIik7CgkJcmV0dXJuIG1heFNpemU7Cgl9OwoKCW1yYWlkLmdldE9yaWVudGF0aW9uUHJvcGVydGllcyA9IGZ1bmN0aW9uKCkgewoJCWxvZy5pKCJtcmFpZC5nZXRPcmllbnRhdGlvblByb3BlcnRpZXMiKTsKCQlyZXR1cm4gb3JpZW50YXRpb25Qcm9wZXJ0aWVzOwoJfTsKCgltcmFpZC5nZXRQbGFjZW1lbnRUeXBlID0gZnVuY3Rpb24oKSB7CgkJbG9nLmkoIm1yYWlkLmdldFBsYWNlbWVudFR5cGUiKTsKCQlyZXR1cm4gcGxhY2VtZW50VHlwZTsKCX07CgoJbXJhaWQuZ2V0UmVzaXplUHJvcGVydGllcyA9IGZ1bmN0aW9uKCkgewoJCWxvZy5pKCJtcmFpZC5nZXRSZXNpemVQcm9wZXJ0aWVzIik7CgkJcmV0dXJuIHJlc2l6ZVByb3BlcnRpZXM7Cgl9OwoKCW1yYWlkLmdldFNjcmVlblNpemUgPSBmdW5jdGlvbigpIHsKCQlsb2cuaSgibXJhaWQuZ2V0U2NyZWVuU2l6ZSIpOwoJCXJldHVybiBzY3JlZW5TaXplOwoJfTsKCgltcmFpZC5nZXRTdGF0ZSA9IGZ1bmN0aW9uKCkgewoJCWxvZy5pKCJtcmFpZC5nZXRTdGF0ZSIpOwoJCXJldHVybiBzdGF0ZTsKCX07CgoJbXJhaWQuZ2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCkgewoJCWxvZy5pKCJtcmFpZC5nZXRWZXJzaW9uIik7CgkJcmV0dXJuIFZFUlNJT047Cgl9OwoKCW1yYWlkLmlzVmlld2FibGUgPSBmdW5jdGlvbigpIHsKCQlsb2cuaSgibXJhaWQuaXNWaWV3YWJsZSIpOwoJCXJldHVybiBpc1ZpZXdhYmxlOwoJfTsKCgltcmFpZC5vcGVuID0gZnVuY3Rpb24odXJsKSB7CgkJbG9nLmkoIm1yYWlkLm9wZW4gIiArIHVybCk7CgkJY2FsbE5hdGl2ZSgib3Blbj91cmw9IiArIGVuY29kZVVSSUNvbXBvbmVudCh1cmwpKTsKCX07CgoJbXJhaWQucGxheVZpZGVvID0gZnVuY3Rpb24odXJsKSB7CgkJbG9nLmkoIm1yYWlkLnBsYXlWaWRlbyAiICsgdXJsKTsKCQljYWxsTmF0aXZlKCJwbGF5VmlkZW8/dXJsPSIgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKSk7Cgl9OwoKCW1yYWlkLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgbGlzdGVuZXIpIHsKCQlsb2cuaSgibXJhaWQucmVtb3ZlRXZlbnRMaXN0ZW5lciAiICsgZXZlbnQgKyAiIDogIiArIFN0cmluZyhsaXN0ZW5lcikpOwoJCWlmICghZXZlbnQpIHsKCQkJbXJhaWQuZmlyZUVycm9yRXZlbnQoIkV2ZW50IGlzIHJlcXVpcmVkLiIsICJyZW1vdmVFdmVudExpc3RlbmVyIik7CgkJCXJldHVybjsKCQl9CgkJaWYgKCFjb250YWlucyhldmVudCwgRVZFTlRTKSkgewoJCQltcmFpZC5maXJlRXJyb3JFdmVudCgiVW5rbm93biBNUkFJRCBldmVudDogIiArIGV2ZW50LCAicmVtb3ZlRXZlbnRMaXN0ZW5lciIpOwoJCQlyZXR1cm47CgkJfQoJCWlmIChsaXN0ZW5lcnMuaGFzT3duUHJvcGVydHkoZXZlbnQpKSB7CgkJCWlmIChsaXN0ZW5lcikgewoJCQkJdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gbGlzdGVuZXJzW2V2ZW50XTsKCQkJCS8vIHRyeSB0byBmaW5kIHRoZSBnaXZlbiBsaXN0ZW5lcgoJCQkJdmFyIGxlbiA9IGxpc3RlbmVyc0ZvckV2ZW50Lmxlbmd0aDsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKCQkJCQl2YXIgcmVnaXN0ZXJlZExpc3RlbmVyID0gbGlzdGVuZXJzRm9yRXZlbnRbaV07CgkJCQkJdmFyIHN0cjEgPSBTdHJpbmcobGlzdGVuZXIpOwoJCQkJCXZhciBzdHIyID0gU3RyaW5nKHJlZ2lzdGVyZWRMaXN0ZW5lcik7CgkJCQkJaWYgKGxpc3RlbmVyID09PSByZWdpc3RlcmVkTGlzdGVuZXIgfHwgc3RyMSA9PT0gc3RyMikgewoJCQkJCQlsaXN0ZW5lcnNGb3JFdmVudC5zcGxpY2UoaSwgMSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCWlmIChpID09PSBsZW4pIHsKCQkJCQlsb2cuaSgibGlzdGVuZXIgIiArIHN0cjEgKyAiIG5vdCBmb3VuZCBmb3IgZXZlbnQgIiArIGV2ZW50KTsKCQkJCX0KCQkJCWlmIChsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGggPT09IDApIHsKCQkJCQlkZWxldGUgbGlzdGVuZXJzW2V2ZW50XTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIG5vIGxpc3RlbmVyIHRvIHJlbW92ZSB3YXMgcHJvdmlkZWQsIHNvIHJlbW92ZSBhbGwgbGlzdGVuZXJzCgkJCQkvLyBmb3IgZ2l2ZW4gZXZlbnQKCQkJCWRlbGV0ZSBsaXN0ZW5lcnNbZXZlbnRdOwoJCQl9CgkJfSBlbHNlIHsKCQkJbG9nLmkoIm5vIGxpc3RlbmVycyByZWdpc3RlcmVkIGZvciBldmVudCAiICsgZXZlbnQpOwoJCX0KCX07CgoJbXJhaWQucmVzaXplID0gZnVuY3Rpb24oKSB7CgkJbG9nLmkoIm1yYWlkLnJlc2l6ZSIpOwoJCS8vIFRoZSBvbmx5IHRpbWUgaXQgaXMgdmFsaWQgdG8gY2FsbCByZXNpemUgaXMgd2hlbiB0aGUgYWQgaXMKCQkvLyBhIGJhbm5lciBjdXJyZW50bHkgaW4gZWl0aGVyIGRlZmF1bHQgb3IgcmVzaXplZCBzdGF0ZS4KCQkvLyBUcmlnZ2VyIGFuIGVycm9yIGlmIHRoZSBjdXJyZW50IHN0YXRlIGlzIGV4cGFuZGVkLgoJCWlmIChwbGFjZW1lbnRUeXBlID09PSBQTEFDRU1FTlRfVFlQRVMuSU5URVJTVElUSUFMIHx8IHN0YXRlID09PSBTVEFURVMuTE9BRElORyB8fCBzdGF0ZSA9PT0gU1RBVEVTLkhJRERFTikgewoJCQkvLyBkbyBub3RoaW5nCgkJCXJldHVybjsKCQl9CgkJaWYgKHN0YXRlID09PSBTVEFURVMuRVhQQU5ERUQpIHsKCQkJbXJhaWQuZmlyZUVycm9yRXZlbnQoIm1yYWlkLnJlc2l6ZSBjYWxsZWQgd2hlbiBhZCBpcyBpbiBleHBhbmRlZCBzdGF0ZSIsICJtcmFpZC5yZXNpemUiKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIWlzUmVzaXplUmVhZHkpIHsKCQkJbXJhaWQuZmlyZUVycm9yRXZlbnQoIm1yYWlkLnJlc2l6ZSBpcyBub3QgcmVhZHkgdG8gYmUgY2FsbGVkIiwgIm1yYWlkLnJlc2l6ZSIpOwoJCQlyZXR1cm47CgkJfQoJCWNhbGxOYXRpdmUoInJlc2l6ZSIpOwoJfTsKCgltcmFpZC5zZXRFeHBhbmRQcm9wZXJ0aWVzID0gZnVuY3Rpb24ocHJvcGVydGllcykgewoJCWxvZy5pKCJtcmFpZC5zZXRFeHBhbmRQcm9wZXJ0aWVzIik7CgoJCWlmICghdmFsaWRhdGUocHJvcGVydGllcywgInNldEV4cGFuZFByb3BlcnRpZXMiKSkgewoJCQlsb2cuZSgiZmFpbGVkIHZhbGlkYXRpb24iKTsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIG9sZFVzZUN1c3RvbUNsb3NlID0gZXhwYW5kUHJvcGVydGllcy51c2VDdXN0b21DbG9zZTsKCgkJLy8gZXhwYW5kUHJvcGVydGllcyBjb250YWlucyAzIHJlYWQtd3JpdGUgcHJvcGVydGllczogd2lkdGgsIGhlaWdodCwgYW5kIHVzZUN1c3RvbUNsb3NlOwoJCS8vIHRoZSBpc01vZGFsIHByb3BlcnR5IGlzIHJlYWQtb25seQoJCXZhciByd1Byb3BzID0gWyAid2lkdGgiLCAiaGVpZ2h0IiwgInVzZUN1c3RvbUNsb3NlIiBdOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgcndQcm9wcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcHJvcG5hbWUgPSByd1Byb3BzW2ldOwoJCQlpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKCQkJCWV4cGFuZFByb3BlcnRpZXNbcHJvcG5hbWVdID0gcHJvcGVydGllc1twcm9wbmFtZV07CgkJCX0KCQl9CgoJCS8vIEluIE1SQUlEIHYyLjAsIGFsbCBleHBhbmRlZCBhZHMgYnkgZGVmaW5pdGlvbiBjb3ZlciB0aGUgZW50aXJlIHNjcmVlbiwKCQkvLyBzbyB0aGUgb25seSBwcm9wZXJ0eSB0aGF0IHRoZSBuYXRpdmUgc2lkZSBoYXMgdG8ga25vdyBhYm91dCBpcyB1c2VDdXN0b21DbG9zZS4KCQkvLyAoVGhhdCBpcywgdGhlIHdpZHRoIGFuZCBoZWlnaHQgcHJvcGVydGllcyBhcmUgbm90IG5lZWRlZCBieSB0aGUgbmF0aXZlIGNvZGUuKQoJCWlmIChleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlICE9PSBvbGRVc2VDdXN0b21DbG9zZSkgewoJCQljYWxsTmF0aXZlKCJ1c2VDdXN0b21DbG9zZT91c2VDdXN0b21DbG9zZT0iCSsgZXhwYW5kUHJvcGVydGllcy51c2VDdXN0b21DbG9zZSk7CgkJfQoJCQoJCWlzRXhwYW5kUHJvcGVydGllc1NldCA9IHRydWU7Cgl9OwoKCW1yYWlkLnNldE9yaWVudGF0aW9uUHJvcGVydGllcyA9IGZ1bmN0aW9uKHByb3BlcnRpZXMpIHsKCQlsb2cuaSgibXJhaWQuc2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIik7CgoJCWlmICghdmFsaWRhdGUocHJvcGVydGllcywgInNldE9yaWVudGF0aW9uUHJvcGVydGllcyIpKSB7CgkJCWxvZy5lKCJmYWlsZWQgdmFsaWRhdGlvbiIpOwoJCQlyZXR1cm47CgkJfQoKCQl2YXIgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzID0ge307CgkJbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzLmFsbG93T3JpZW50YXRpb25DaGFuZ2UgPSBvcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZSwKCQluZXdPcmllbnRhdGlvblByb3BlcnRpZXMuZm9yY2VPcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uOwoKCQkvLyBvcmllbnRhdGlvblByb3BlcnRpZXMgY29udGFpbnMgMiByZWFkLXdyaXRlIHByb3BlcnRpZXM6CgkJLy8gYWxsb3dPcmllbnRhdGlvbkNoYW5nZSBhbmQgZm9yY2VPcmllbnRhdGlvbgoJCXZhciByd1Byb3BzID0gWyAiYWxsb3dPcmllbnRhdGlvbkNoYW5nZSIsICJmb3JjZU9yaWVudGF0aW9uIiBdOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgcndQcm9wcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcHJvcG5hbWUgPSByd1Byb3BzW2ldOwoJCQlpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKCQkJCW5ld09yaWVudGF0aW9uUHJvcGVydGllc1twcm9wbmFtZV0gPSBwcm9wZXJ0aWVzW3Byb3BuYW1lXTsKCQkJfQoJCX0KCgkJLy8gU2V0dGluZyBhbGxvd09yaWVudGF0aW9uQ2hhbmdlIHRvIHRydWUgd2hpbGUgc2V0dGluZyBmb3JjZU9yaWVudGF0aW9uCgkJLy8gdG8gZWl0aGVyIHBvcnRyYWl0IG9yIGxhbmRzY2FwZQoJCS8vIGlzIGNvbnNpZGVyZWQgYW4gZXJyb3IgY29uZGl0aW9uLgoJCWlmIChuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZQoJCQkJJiYgbmV3T3JpZW50YXRpb25Qcm9wZXJ0aWVzLmZvcmNlT3JpZW50YXRpb24gIT09IG1yYWlkLk9SSUVOVEFUSU9OX1BST1BFUlRJRVNfRk9SQ0VfT1JJRU5UQVRJT04uTk9ORSkgewoJCQltcmFpZC5maXJlRXJyb3JFdmVudCgKCQkJCQkiYWxsb3dPcmllbnRhdGlvbkNoYW5nZSBpcyB0cnVlIGJ1dCBmb3JjZU9yaWVudGF0aW9uIGlzICIKCQkJCQkrIG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uLAoJCQkJCSJzZXRPcmllbnRhdGlvblByb3BlcnRpZXMiKTsKCQkJcmV0dXJuOwoJCX0KCgkJb3JpZW50YXRpb25Qcm9wZXJ0aWVzLmFsbG93T3JpZW50YXRpb25DaGFuZ2UgPSBuZXdPcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZTsKCQlvcmllbnRhdGlvblByb3BlcnRpZXMuZm9yY2VPcmllbnRhdGlvbiA9IG5ld09yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uOwoKCQl2YXIgcGFyYW1zID0gImFsbG93T3JpZW50YXRpb25DaGFuZ2U9IgoJCQkJKyBvcmllbnRhdGlvblByb3BlcnRpZXMuYWxsb3dPcmllbnRhdGlvbkNoYW5nZQoJCQkJKyAiJmZvcmNlT3JpZW50YXRpb249IiArIG9yaWVudGF0aW9uUHJvcGVydGllcy5mb3JjZU9yaWVudGF0aW9uOwoKCQljYWxsTmF0aXZlKCJzZXRPcmllbnRhdGlvblByb3BlcnRpZXM/IiArIHBhcmFtcyk7Cgl9OwoKCW1yYWlkLnNldFJlc2l6ZVByb3BlcnRpZXMgPSBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7CgkJbG9nLmkoIm1yYWlkLnNldFJlc2l6ZVByb3BlcnRpZXMiKTsKCQkKCQlpc1Jlc2l6ZVJlYWR5ID0gZmFsc2U7CgoJCS8vIHJlc2l6ZVByb3BlcnRpZXMgY29udGFpbnMgNiByZWFkLXdyaXRlIHByb3BlcnRpZXM6CgkJLy8gd2lkdGgsIGhlaWdodCwgb2Zmc2V0WCwgb2Zmc2V0WSwgY3VzdG9tQ2xvc2VQb3NpdGlvbiwgYWxsb3dPZmZzY3JlZW4KCgkJLy8gVGhlIHByb3BlcnRpZXMgb2JqZWN0IHBhc3NlZCBpbnRvIHRoaXMgZnVuY3Rpb24gbXVzdCBjb250YWluIHdpZHRoLCBoZWlnaHQsIG9mZnNldFgsIG9mZnNldFkuCgkJLy8gVGhlIHJlbWFpbmluZyB0d28gcHJvcGVydGllcyBhcmUgb3B0aW9uYWwuCgkJdmFyIHJlcXVpcmVkUHJvcHMgPSBbICJ3aWR0aCIsICJoZWlnaHQiLCAib2Zmc2V0WCIsICJvZmZzZXRZIiBdOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVxdWlyZWRQcm9wcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcHJvcG5hbWUgPSByZXF1aXJlZFByb3BzW2ldOwoJCQlpZiAoIXByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcG5hbWUpKSB7CgkJCQltcmFpZC5maXJlRXJyb3JFdmVudCgKCQkJCQkJInJlcXVpcmVkIHByb3BlcnR5ICIgKyBwcm9wbmFtZSArICIgaXMgbWlzc2luZyIsCgkJCQkJCSJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CgkJCQlyZXR1cm47CgkJCX0KCQl9CgkJCgkJaWYgKCF2YWxpZGF0ZShwcm9wZXJ0aWVzLCAic2V0UmVzaXplUHJvcGVydGllcyIpKSB7CgkJCW1yYWlkLmZpcmVFcnJvckV2ZW50KCJmYWlsZWQgdmFsaWRhdGlvbiIsICJtcmFpZC5zZXRSZXNpemVQcm9wZXJ0aWVzIik7CgkJCXJldHVybjsKCQl9CgkJCiAgICAgICAgdmFyIGFkanVzdG1lbnRzID0geyAieCI6IDAsICJ5IjogMCB9OwoJCQoJCXZhciBhbGxvd09mZnNjcmVlbiA9IHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoImFsbG93T2Zmc2NyZWVuIikgPyBwcm9wZXJ0aWVzLmFsbG93T2Zmc2NyZWVuIDogcmVzaXplUHJvcGVydGllcy5hbGxvd09mZnNjcmVlbjsKICAgICAgICBpZiAoIWFsbG93T2Zmc2NyZWVuKSB7CiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLndpZHRoID4gbWF4U2l6ZS53aWR0aCB8fCBwcm9wZXJ0aWVzLmhlaWdodCA+IG1heFNpemUuaGVpZ2h0KSB7CiAgICAgICAgICAgICAgICBtcmFpZC5maXJlRXJyb3JFdmVudCgicmVzaXplIHdpZHRoIG9yIGhlaWdodCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heFNpemUgd2lkdGggb3IgaGVpZ2h0IiwgIm1yYWlkLnNldFJlc2l6ZVByb3BlcnRpZXMiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGp1c3RtZW50cyA9IGZpdFJlc2l6ZVZpZXdPblNjcmVlbihwcm9wZXJ0aWVzKTsKICAgICAgICB9IGVsc2UgaWYgKCFpc0Nsb3NlUmVnaW9uT25TY3JlZW4ocHJvcGVydGllcykpIHsKICAgICAgICAgICAgbXJhaWQuZmlyZUVycm9yRXZlbnQoImNsb3NlIGV2ZW50IHJlZ2lvbiB3aWxsIG5vdCBhcHBlYXIgZW50aXJlbHkgb25zY3JlZW4iLCAibXJhaWQuc2V0UmVzaXplUHJvcGVydGllcyIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoJCQoJCXZhciByd1Byb3BzID0gWyAid2lkdGgiLCAiaGVpZ2h0IiwgIm9mZnNldFgiLCAib2Zmc2V0WSIsICJjdXN0b21DbG9zZVBvc2l0aW9uIiwgImFsbG93T2Zmc2NyZWVuIiBdOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgcndQcm9wcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcHJvcG5hbWUgPSByd1Byb3BzW2ldOwoJCQlpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wbmFtZSkpIHsKCQkJCXJlc2l6ZVByb3BlcnRpZXNbcHJvcG5hbWVdID0gcHJvcGVydGllc1twcm9wbmFtZV07CgkJCX0KCQl9CgkJCgkJdmFyIHBhcmFtcyA9CgkJCSJ3aWR0aD0iICsgcmVzaXplUHJvcGVydGllcy53aWR0aCArCgkJCSImaGVpZ2h0PSIgKyByZXNpemVQcm9wZXJ0aWVzLmhlaWdodCArCgkgICAgICAgICImb2Zmc2V0WD0iICsgKHJlc2l6ZVByb3BlcnRpZXMub2Zmc2V0WCArIGFkanVzdG1lbnRzLngpICsKCSAgICAgICAgIiZvZmZzZXRZPSIgKyAocmVzaXplUHJvcGVydGllcy5vZmZzZXRZICsgYWRqdXN0bWVudHMueSkgKwoJCQkiJmN1c3RvbUNsb3NlUG9zaXRpb249IiArIHJlc2l6ZVByb3BlcnRpZXMuY3VzdG9tQ2xvc2VQb3NpdGlvbiArCgkJCSImYWxsb3dPZmZzY3JlZW49IiArIHJlc2l6ZVByb3BlcnRpZXMuYWxsb3dPZmZzY3JlZW47CgoJCWNhbGxOYXRpdmUoInNldFJlc2l6ZVByb3BlcnRpZXM/IiArIHBhcmFtcyk7CgoJCWlzUmVzaXplUmVhZHkgPSB0cnVlOwoJfTsKCgltcmFpZC5zdG9yZVBpY3R1cmUgPSBmdW5jdGlvbih1cmwpIHsKCQlsb2cuaSgibXJhaWQuc3RvcmVQaWN0dXJlICIgKyB1cmwpOwoJCWlmIChzdXBwb3J0ZWRGZWF0dXJlc1ttcmFpZC5TVVBQT1JURURfRkVBVFVSRVMuU1RPUkVQSUNUVVJFXSkgewoJCQljYWxsTmF0aXZlKCJzdG9yZVBpY3R1cmU/dXJsPSIgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKSk7CgkJfSBlbHNlIHsKCQkJbG9nLmUoInN0b3JlUGljdHVyZSBpcyBub3Qgc3VwcG9ydGVkIik7CgkJfQoJfTsKCgltcmFpZC5zdXBwb3J0cyA9IGZ1bmN0aW9uKGZlYXR1cmUpIHsKCQlsb2cuaSgibXJhaWQuc3VwcG9ydHMgIiArIGZlYXR1cmUgKyAiICIgKyBzdXBwb3J0ZWRGZWF0dXJlc1tmZWF0dXJlXSk7CgkJdmFyIHJldHZhbCA9IHN1cHBvcnRlZEZlYXR1cmVzW2ZlYXR1cmVdOwoJCWlmICh0eXBlb2YgcmV0dmFsID09PSAidW5kZWZpbmVkIikgewoJCQlyZXR2YWwgPSBmYWxzZTsKCQl9CgkJcmV0dXJuIHJldHZhbDsKCX07CgoJbXJhaWQudXNlQ3VzdG9tQ2xvc2UgPSBmdW5jdGlvbihpc0N1c3RvbUNsb3NlKSB7CgkJbG9nLmkoIm1yYWlkLnVzZUN1c3RvbUNsb3NlICIgKyBpc0N1c3RvbUNsb3NlKTsKCQlpZiAoZXhwYW5kUHJvcGVydGllcy51c2VDdXN0b21DbG9zZSAhPT0gaXNDdXN0b21DbG9zZSkgewoJCQlleHBhbmRQcm9wZXJ0aWVzLnVzZUN1c3RvbUNsb3NlID0gaXNDdXN0b21DbG9zZTsKCQkJY2FsbE5hdGl2ZSgidXNlQ3VzdG9tQ2xvc2U/dXNlQ3VzdG9tQ2xvc2U9IgoJCQkJCSsgZXhwYW5kUHJvcGVydGllcy51c2VDdXN0b21DbG9zZSk7CgkJfQoJfTsKCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgkgKiBoZWxwZXIgbWV0aG9kcyBjYWxsZWQgYnkgU0RLCgkgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJLy8gc2V0dGVycyB0byBjaGFuZ2Ugc3RhdGUKCW1yYWlkLnNldEN1cnJlbnRQb3NpdGlvbiA9IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKCQlsb2cuaSgibXJhaWQuc2V0Q3VycmVudFBvc2l0aW9uICIgKyB4ICsgIiwiICsgeSArICIsIiArIHdpZHRoICsgIiwiCSsgaGVpZ2h0KTsKCgkJdmFyIHByZXZpb3VzU2l6ZSA9IHt9OwoJCXByZXZpb3VzU2l6ZS53aWR0aCA9IGN1cnJlbnRQb3NpdGlvbi53aWR0aDsKCQlwcmV2aW91c1NpemUuaGVpZ2h0ID0gY3VycmVudFBvc2l0aW9uLmhlaWdodDsKCQlsb2cuaSgicHJldmlvdXNTaXplICIgKyBwcmV2aW91c1NpemUud2lkdGggKyAiLCIgKyBwcmV2aW91c1NpemUuaGVpZ2h0KTsKCgkJY3VycmVudFBvc2l0aW9uLnggPSB4OwoJCWN1cnJlbnRQb3NpdGlvbi55ID0geTsKCQljdXJyZW50UG9zaXRpb24ud2lkdGggPSB3aWR0aDsKCQljdXJyZW50UG9zaXRpb24uaGVpZ2h0ID0gaGVpZ2h0OwoKCQlpZiAod2lkdGggIT09IHByZXZpb3VzU2l6ZS53aWR0aCB8fCBoZWlnaHQgIT09IHByZXZpb3VzU2l6ZS5oZWlnaHQpIHsKCQkJbXJhaWQuZmlyZVNpemVDaGFuZ2VFdmVudCh3aWR0aCwgaGVpZ2h0KTsKCQl9Cgl9OwoKCW1yYWlkLnNldERlZmF1bHRQb3NpdGlvbiA9IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKCQlsb2cuaSgibXJhaWQuc2V0RGVmYXVsdFBvc2l0aW9uICIgKyB4ICsgIiwiICsgeSArICIsIiArIHdpZHRoICsgIiwiCSsgaGVpZ2h0KTsKCQlkZWZhdWx0UG9zaXRpb24ueCA9IHg7CgkJZGVmYXVsdFBvc2l0aW9uLnkgPSB5OwoJCWRlZmF1bHRQb3NpdGlvbi53aWR0aCA9IHdpZHRoOwoJCWRlZmF1bHRQb3NpdGlvbi5oZWlnaHQgPSBoZWlnaHQ7Cgl9OwoKCW1yYWlkLnNldEV4cGFuZFNpemUgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7CgkJbG9nLmkoIm1yYWlkLnNldEV4cGFuZFNpemUgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKCQlleHBhbmRQcm9wZXJ0aWVzLndpZHRoID0gd2lkdGg7CgkJZXhwYW5kUHJvcGVydGllcy5oZWlnaHQgPSBoZWlnaHQ7Cgl9OwoKCW1yYWlkLnNldE1heFNpemUgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7CgkJbG9nLmkoIm1yYWlkLnNldE1heFNpemUgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKCQltYXhTaXplLndpZHRoID0gd2lkdGg7CgkJbWF4U2l6ZS5oZWlnaHQgPSBoZWlnaHQ7Cgl9OwoKCW1yYWlkLnNldFBsYWNlbWVudFR5cGUgPSBmdW5jdGlvbihwdCkgewoJCWxvZy5pKCJtcmFpZC5zZXRQbGFjZW1lbnRUeXBlICIgKyBwdCk7CgkJcGxhY2VtZW50VHlwZSA9IHB0OwoJfTsKCgltcmFpZC5zZXRTY3JlZW5TaXplID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCkgewoJCWxvZy5pKCJtcmFpZC5zZXRTY3JlZW5TaXplICIgKyB3aWR0aCArICJ4IiArIGhlaWdodCk7CgkJc2NyZWVuU2l6ZS53aWR0aCA9IHdpZHRoOwoJCXNjcmVlblNpemUuaGVpZ2h0ID0gaGVpZ2h0OwoJCWlmICghaXNFeHBhbmRQcm9wZXJ0aWVzU2V0KSB7CgkJCWV4cGFuZFByb3BlcnRpZXMud2lkdGggPSB3aWR0aDsKCQkJZXhwYW5kUHJvcGVydGllcy5oZWlnaHQgPSBoZWlnaHQ7OwoJCX0KCX07CgoJbXJhaWQuc2V0U3VwcG9ydHMgPSBmdW5jdGlvbihmZWF0dXJlLCBzdXBwb3J0ZWQpIHsKCQlsb2cuaSgibXJhaWQuc2V0U3VwcG9ydHMgIiArIGZlYXR1cmUgKyAiICIgKyBzdXBwb3J0ZWQpOwoJCXN1cHBvcnRlZEZlYXR1cmVzW2ZlYXR1cmVdID0gc3VwcG9ydGVkOwoJfTsKCgkvLyBtZXRob2RzIHRvIGZpcmUgZXZlbnRzCgoJbXJhaWQuZmlyZUVycm9yRXZlbnQgPSBmdW5jdGlvbihtZXNzYWdlLCBhY3Rpb24pIHsKCQlsb2cuaSgibXJhaWQuZmlyZUVycm9yRXZlbnQgIiArIG1lc3NhZ2UgKyAiICIgKyBhY3Rpb24pOwoJCWZpcmVFdmVudChtcmFpZC5FVkVOVFMuRVJST1IsIG1lc3NhZ2UsIGFjdGlvbik7Cgl9OwoKCW1yYWlkLmZpcmVSZWFkeUV2ZW50ID0gZnVuY3Rpb24oKSB7CgkJbG9nLmkoIm1yYWlkLmZpcmVSZWFkeUV2ZW50Iik7CgkJZmlyZUV2ZW50KG1yYWlkLkVWRU5UUy5SRUFEWSk7Cgl9OwoKCW1yYWlkLmZpcmVTaXplQ2hhbmdlRXZlbnQgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7CgkJbG9nLmkoIm1yYWlkLmZpcmVTaXplQ2hhbmdlRXZlbnQgIiArIHdpZHRoICsgIngiICsgaGVpZ2h0KTsKCQlpZiAoc3RhdGUgIT09IG1yYWlkLlNUQVRFUy5MT0FESU5HKSB7CgkJCWZpcmVFdmVudChtcmFpZC5FVkVOVFMuU0laRUNIQU5HRSwgd2lkdGgsIGhlaWdodCk7CgkJfQoJfTsKCgltcmFpZC5maXJlU3RhdGVDaGFuZ2VFdmVudCA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7CgkJbG9nLmkoIm1yYWlkLmZpcmVTdGF0ZUNoYW5nZUV2ZW50ICIgKyBuZXdTdGF0ZSk7CgkJaWYgKHN0YXRlICE9PSBuZXdTdGF0ZSkgewoJCQlzdGF0ZSA9IG5ld1N0YXRlOwoJCQlmaXJlRXZlbnQobXJhaWQuRVZFTlRTLlNUQVRFQ0hBTkdFLCBzdGF0ZSk7CgkJfQoJfTsKCgltcmFpZC5maXJlVmlld2FibGVDaGFuZ2VFdmVudCA9IGZ1bmN0aW9uKG5ld0lzVmlld2FibGUpIHsKCQlsb2cuaSgibXJhaWQuZmlyZVZpZXdhYmxlQ2hhbmdlRXZlbnQgIiArIG5ld0lzVmlld2FibGUpOwoJCWlmIChpc1ZpZXdhYmxlICE9PSBuZXdJc1ZpZXdhYmxlKSB7CgkJCWlzVmlld2FibGUgPSBuZXdJc1ZpZXdhYmxlOwoJCQlmaXJlRXZlbnQobXJhaWQuRVZFTlRTLlZJRVdBQkxFQ0hBTkdFLCBpc1ZpZXdhYmxlKTsKCQl9Cgl9OwoKCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCSAqIGludGVybmFsIGhlbHBlciBtZXRob2RzCgkgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJZnVuY3Rpb24gY2FsbE5hdGl2ZShjb21tYW5kKSB7CgkJdmFyIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIklGUkFNRSIpOwoJCWlmcmFtZS5zZXRBdHRyaWJ1dGUoInNyYyIsICJtcmFpZDovLyIgKyBjb21tYW5kKTsKCQlkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKCQlpZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpZnJhbWUpOwoJCWlmcmFtZSA9IG51bGw7Cgl9OwoKCWZ1bmN0aW9uIGZpcmVFdmVudChldmVudCkgewoJCXZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKCQlhcmdzLnNoaWZ0KCk7CgkJbG9nLmkoImZpcmVFdmVudCAiICsgZXZlbnQgKyAiIFsiICsgYXJncy50b1N0cmluZygpICsgIl0iKTsKCQl2YXIgZXZlbnRMaXN0ZW5lcnMgPSAobGlzdGVuZXJzW2V2ZW50XXx8W10pLnNsaWNlKDApOwoJCWlmIChldmVudExpc3RlbmVycykgewoJCQlsb2cuaShldmVudExpc3RlbmVycy5sZW5ndGggKyAiIGxpc3RlbmVyKHMpIGZvdW5kIGZvciAiICsgZXZlbnQpOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50TGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7CgkJCSAgICBsb2cuaSgiZmlyaW5nIGxpc3RlbmVyICIgKyBpICsgIiBmb3IgIiArIGV2ZW50ICsgIjogIiArIGV2ZW50TGlzdGVuZXJzW2ldKTsKCQkJCWV2ZW50TGlzdGVuZXJzW2ldLmFwcGx5KG51bGwsIGFyZ3MpOwoJCQl9CgkJfSBlbHNlIHsKCQkJbG9nLmkoIm5vIGxpc3RlbmVycyBmb3VuZCIpOwoJCX0KCX07CgoJZnVuY3Rpb24gY29udGFpbnModmFsdWUsIGFycmF5KSB7CgkJZm9yICggdmFyIGkgaW4gYXJyYXkpIHsKCQkJaWYgKGFycmF5W2ldID09PSB2YWx1ZSkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgkJcmV0dXJuIGZhbHNlOwoJfTsKCgkvLyBUaGUgYWN0aW9uIHBhcmFtZXRlciBpcyBhIHN0cmluZyB3aGljaCBpcyB0aGUgbmFtZSBvZiB0aGUgc2V0dGVyIGZ1bmN0aW9uCgkvLyB3aGljaCBjYWxsZWQgdGhpcyBmdW5jdGlvbgoJLy8gKGluIG90aGVyIHdvcmRzLCBzZXRFeHBhbmRQcm9wZXRpZXMsIHNldE9yaWVudGF0aW9uUHJvcGVydGllcywgb3IKCS8vIHNldFJlc2l6ZVByb3BlcnRpZXMpLgoJLy8gSXQgc2VydmVzIGJvdGggYXMgdGhlIGtleSB0byBnZXQgdGhlIHRoZSBhcHByb3ByaWF0ZSBzZXQgb2YgdmFsaWRhdGluZwoJLy8gZnVuY3Rpb25zIGZyb20gdGhlIGFsbFZhbGlkYXRvcnMgb2JqZWN0CgkvLyBhcyB3ZWxsIGFzIHRoZSBhY3Rpb24gcGFyYW1ldGVyIG9mIGFueSBlcnJvciBldmVudCB0aGF0IG1heSBiZSB0aHJvd24uCglmdW5jdGlvbiB2YWxpZGF0ZShwcm9wZXJ0aWVzLCBhY3Rpb24pIHsKCQl2YXIgcmV0dmFsID0gdHJ1ZTsKCQl2YXIgdmFsaWRhdG9ycyA9IGFsbFZhbGlkYXRvcnNbYWN0aW9uXTsKCQlmb3IgKHZhciBwcm9wIGluIHByb3BlcnRpZXMpIHsKCQkJdmFyIHZhbGlkYXRvciA9IHZhbGlkYXRvcnNbcHJvcF07CgkJCXZhciB2YWx1ZSA9IHByb3BlcnRpZXNbcHJvcF07CgkJCWlmICh2YWxpZGF0b3IgJiYgIXZhbGlkYXRvcih2YWx1ZSkpIHsKCQkJCW1yYWlkLmZpcmVFcnJvckV2ZW50KCJWYWx1ZSBvZiBwcm9wZXJ0eSAiICsgcHJvcCArICIgKCIgKyB2YWx1ZQkrICIpIGlzIGludmFsaWQiLCAibXJhaWQuIiArIGFjdGlvbik7CgkJCQlyZXR2YWwgPSBmYWxzZTsKCQkJfQoJCX0KCQlyZXR1cm4gcmV0dmFsOwoJfTsKCgl2YXIgYWxsVmFsaWRhdG9ycyA9IHsKCQkic2V0RXhwYW5kUHJvcGVydGllcyIgOiB7CgkJCS8vIEluIE1SQUlEIDIuMCwgdGhlIG9ubHkgcHJvcGVydHkgaW4gZXhwYW5kUHJvcGVydGllcyB3ZSBhY3R1YWxseSBjYXJlIGFib3V0IGlzIHVzZUN1c3RvbUNsb3NlLgoJCQkvLyBTdGlsbCwgd2UnbGwgZG8gYSBiYXNpYyBzYW5pdHkgY2hlY2sgb24gdGhlIHdpZHRoIGFuZCBoZWlnaHQgcHJvcGVydGllcywgdG9vLgoJCQkid2lkdGgiIDogZnVuY3Rpb24od2lkdGgpIHsKCQkJCXJldHVybiAhaXNOYU4od2lkdGgpOwoJCQl9LAoJCQkiaGVpZ2h0IiA6IGZ1bmN0aW9uKGhlaWdodCkgewoJCQkJcmV0dXJuICFpc05hTihoZWlnaHQpOwoJCQl9LAoJCQkidXNlQ3VzdG9tQ2xvc2UiIDogZnVuY3Rpb24odXNlQ3VzdG9tQ2xvc2UpIHsKCQkJCXJldHVybiAodHlwZW9mIHVzZUN1c3RvbUNsb3NlID09PSAiYm9vbGVhbiIpOwoJCQl9CgkJfSwKCQkic2V0T3JpZW50YXRpb25Qcm9wZXJ0aWVzIiA6IHsKCQkJImFsbG93T3JpZW50YXRpb25DaGFuZ2UiIDogZnVuY3Rpb24oYWxsb3dPcmllbnRhdGlvbkNoYW5nZSkgewoJCQkJcmV0dXJuICh0eXBlb2YgYWxsb3dPcmllbnRhdGlvbkNoYW5nZSA9PT0gImJvb2xlYW4iKTsKCQkJfSwKCQkJImZvcmNlT3JpZW50YXRpb24iIDogZnVuY3Rpb24oZm9yY2VPcmllbnRhdGlvbikgewoJCQkJdmFyIHZhbGlkVmFsdWVzID0gWyAicG9ydHJhaXQiLCAibGFuZHNjYXBlIiwgIm5vbmUiIF07CgkJCQlyZXR1cm4gKHR5cGVvZiBmb3JjZU9yaWVudGF0aW9uID09PSAic3RyaW5nIiAmJiB2YWxpZFZhbHVlcy5pbmRleE9mKGZvcmNlT3JpZW50YXRpb24pICE9PSAtMSk7CgkJCX0KCQl9LAoJCSJzZXRSZXNpemVQcm9wZXJ0aWVzIiA6IHsKCQkJIndpZHRoIiA6IGZ1bmN0aW9uKHdpZHRoKSB7CgkJCQlyZXR1cm4gIWlzTmFOKHdpZHRoKSAmJiA1MCA8PSB3aWR0aDsKCQkJfSwKCQkJImhlaWdodCIgOiBmdW5jdGlvbihoZWlnaHQpIHsKCQkJCXJldHVybiAhaXNOYU4oaGVpZ2h0KSAmJiA1MCA8PSBoZWlnaHQ7CgkJCX0sCgkJCSJvZmZzZXRYIiA6IGZ1bmN0aW9uKG9mZnNldFgpIHsKCQkJCXJldHVybiAhaXNOYU4ob2Zmc2V0WCk7CgkJCX0sCgkJCSJvZmZzZXRZIiA6IGZ1bmN0aW9uKG9mZnNldFkpIHsKCQkJCXJldHVybiAhaXNOYU4ob2Zmc2V0WSk7CgkJCX0sCgkJCSJjdXN0b21DbG9zZVBvc2l0aW9uIiA6IGZ1bmN0aW9uKGN1c3RvbUNsb3NlUG9zaXRpb24pIHsKCQkJCXZhciB2YWxpZFBvc2l0aW9ucyA9IFsgInRvcC1sZWZ0IiwgInRvcC1jZW50ZXIiLCAidG9wLXJpZ2h0IiwKCQkJCSAgICAgICAgICAgICAgICAgICAgICAgImNlbnRlciIsCgkJCQkgICAgICAgICAgICAgICAgICAgICAgICJib3R0b20tbGVmdCIsICJib3R0b20tY2VudGVyIiwJImJvdHRvbS1yaWdodCIgXTsKCQkJCXJldHVybiAodHlwZW9mIGN1c3RvbUNsb3NlUG9zaXRpb24gPT09ICJzdHJpbmciICYmIHZhbGlkUG9zaXRpb25zLmluZGV4T2YoY3VzdG9tQ2xvc2VQb3NpdGlvbikgIT09IC0xKTsKCQkJfSwKCQkJImFsbG93T2Zmc2NyZWVuIiA6IGZ1bmN0aW9uKGFsbG93T2Zmc2NyZWVuKSB7CgkJCQlyZXR1cm4gKHR5cGVvZiBhbGxvd09mZnNjcmVlbiA9PT0gImJvb2xlYW4iKTsKCQkJfQoJCX0KCX07CgkKICAgIGZ1bmN0aW9uIGlzQ2xvc2VSZWdpb25PblNjcmVlbihwcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nLmQoImlzQ2xvc2VSZWdpb25PblNjcmVlbiIpOwogICAgICAgIGxvZy5kKCJkZWZhdWx0UG9zaXRpb24gIiArIGRlZmF1bHRQb3NpdGlvbi54ICsgIiAiICsgZGVmYXVsdFBvc2l0aW9uLnkpOwogICAgICAgIGxvZy5kKCJvZmZzZXQgIiArIHByb3BlcnRpZXMub2Zmc2V0WCArICIgIiArIHByb3BlcnRpZXMub2Zmc2V0WSk7CgogICAgICAgIHZhciByZXNpemVSZWN0ID0ge307CiAgICAgICAgcmVzaXplUmVjdC54ID0gZGVmYXVsdFBvc2l0aW9uLnggKyBwcm9wZXJ0aWVzLm9mZnNldFg7CiAgICAgICAgcmVzaXplUmVjdC55ID0gZGVmYXVsdFBvc2l0aW9uLnkgKyBwcm9wZXJ0aWVzLm9mZnNldFk7CiAgICAgICAgcmVzaXplUmVjdC53aWR0aCA9IHByb3BlcnRpZXMud2lkdGg7CiAgICAgICAgcmVzaXplUmVjdC5oZWlnaHQgPSBwcm9wZXJ0aWVzLmhlaWdodDsKICAgICAgICBwcmludFJlY3QoInJlc2l6ZVJlY3QiLCByZXNpemVSZWN0KTsKCgkJdmFyIGN1c3RvbUNsb3NlUG9zaXRpb24gPSBwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KCJjdXN0b21DbG9zZVBvc2l0aW9uIikgPwoJCQkJcHJvcGVydGllcy5jdXN0b21DbG9zZVBvc2l0aW9uIDogcmVzaXplUHJvcGVydGllcy5jdXN0b21DbG9zZVBvc2l0aW9uOwogICAgICAgIGxvZy5kKCJjdXN0b21DbG9zZVBvc2l0aW9uICIgKyBjdXN0b21DbG9zZVBvc2l0aW9uKTsKICAgICAgICAKICAgICAgICB2YXIgY2xvc2VSZWN0ID0geyAid2lkdGgiOiA1MCwgImhlaWdodCI6IDUwIH07CgogICAgICAgIGlmIChjdXN0b21DbG9zZVBvc2l0aW9uLnNlYXJjaCgibGVmdCIpICE9PSAtMSkgewogICAgICAgICAgICBjbG9zZVJlY3QueCA9IHJlc2l6ZVJlY3QueDsKICAgICAgICB9IGVsc2UgaWYgKGN1c3RvbUNsb3NlUG9zaXRpb24uc2VhcmNoKCJjZW50ZXIiKSAhPT0gLTEpIHsKICAgICAgICAgICAgY2xvc2VSZWN0LnggPSByZXNpemVSZWN0LnggKyAocmVzaXplUmVjdC53aWR0aCAvIDIpIC0gMjU7CiAgICAgICAgfSBlbHNlIGlmIChjdXN0b21DbG9zZVBvc2l0aW9uLnNlYXJjaCgicmlnaHQiKSAhPT0gLTEpIHsKICAgICAgICAgICAgY2xvc2VSZWN0LnggPSByZXNpemVSZWN0LnggKyByZXNpemVSZWN0LndpZHRoIC0gNTA7CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VzdG9tQ2xvc2VQb3NpdGlvbi5zZWFyY2goInRvcCIpICE9PSAtMSkgewogICAgICAgICAgICBjbG9zZVJlY3QueSA9IHJlc2l6ZVJlY3QueTsKICAgICAgICB9IGVsc2UgaWYgKGN1c3RvbUNsb3NlUG9zaXRpb24gPT09ICJjZW50ZXIiKSB7CiAgICAgICAgICAgIGNsb3NlUmVjdC55ID0gcmVzaXplUmVjdC55ICsgKHJlc2l6ZVJlY3QuaGVpZ2h0IC8gMikgLSAyNTsKICAgICAgICB9IGVsc2UgaWYgKGN1c3RvbUNsb3NlUG9zaXRpb24uc2VhcmNoKCJib3R0b20iKSAhPT0gLTEpIHsKICAgICAgICAgICAgY2xvc2VSZWN0LnkgPSByZXNpemVSZWN0LnkgKyByZXNpemVSZWN0LmhlaWdodCAtIDUwOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1heFJlY3QgPSB7ICJ4IjogMCwgInkiOiAwIH07CiAgICAgICAgbWF4UmVjdC53aWR0aCA9IG1heFNpemUud2lkdGg7CiAgICAgICAgbWF4UmVjdC5oZWlnaHQgPSBtYXhTaXplLmhlaWdodDsKCiAgICAgICAgcmV0dXJuIGlzUmVjdENvbnRhaW5lZChtYXhSZWN0LCBjbG9zZVJlY3QpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBmaXRSZXNpemVWaWV3T25TY3JlZW4ocHJvcGVydGllcykgewogICAgICAgIGxvZy5kKCJmaXRSZXNpemVWaWV3T25TY3JlZW4iKTsKICAgICAgICBsb2cuZCgiZGVmYXVsdFBvc2l0aW9uICIgKyBkZWZhdWx0UG9zaXRpb24ueCArICIgIiArIGRlZmF1bHRQb3NpdGlvbi55KTsKICAgICAgICBsb2cuZCgib2Zmc2V0ICIgKyBwcm9wZXJ0aWVzLm9mZnNldFggKyAiICIgKyBwcm9wZXJ0aWVzLm9mZnNldFkpOwoKICAgICAgICB2YXIgcmVzaXplUmVjdCA9IHt9OwogICAgICAgIHJlc2l6ZVJlY3QueCA9IGRlZmF1bHRQb3NpdGlvbi54ICsgcHJvcGVydGllcy5vZmZzZXRYOwogICAgICAgIHJlc2l6ZVJlY3QueSA9IGRlZmF1bHRQb3NpdGlvbi55ICsgcHJvcGVydGllcy5vZmZzZXRZOwogICAgICAgIHJlc2l6ZVJlY3Qud2lkdGggPSBwcm9wZXJ0aWVzLndpZHRoOwogICAgICAgIHJlc2l6ZVJlY3QuaGVpZ2h0ID0gcHJvcGVydGllcy5oZWlnaHQ7CiAgICAgICAgcHJpbnRSZWN0KCJyZXNpemVSZWN0IiwgcmVzaXplUmVjdCk7CgogICAgICAgIHZhciBtYXhSZWN0ID0geyAieCI6IDAsICJ5IjogMCB9OwogICAgICAgIG1heFJlY3Qud2lkdGggPSBtYXhTaXplLndpZHRoOwogICAgICAgIG1heFJlY3QuaGVpZ2h0ID0gbWF4U2l6ZS5oZWlnaHQ7CgogICAgICAgIHZhciBhZGp1c3RtZW50cyA9IHsgIngiOiAwLCAieSI6IDAgfTsKCiAgICAgICAgaWYgKGlzUmVjdENvbnRhaW5lZChtYXhSZWN0LCByZXNpemVSZWN0KSkgewogICAgICAgICAgICBsb2cuZCgibm8gYWRqdXN0bWVudCBuZWNlc3NhcnkiKTsKICAgICAgICAgICAgcmV0dXJuIGFkanVzdG1lbnRzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc2l6ZVJlY3QueCA8IG1heFJlY3QueCkgewogICAgICAgICAgICBhZGp1c3RtZW50cy54ID0gbWF4UmVjdC54IC0gcmVzaXplUmVjdC54OwogICAgICAgIH0gZWxzZSBpZiAoKHJlc2l6ZVJlY3QueCArIHJlc2l6ZVJlY3Qud2lkdGgpID4gKG1heFJlY3QueCArIG1heFJlY3Qud2lkdGgpKSB7CiAgICAgICAgICAgIGFkanVzdG1lbnRzLnggPSAobWF4UmVjdC54ICsgbWF4UmVjdC53aWR0aCkgLSAocmVzaXplUmVjdC54ICsgcmVzaXplUmVjdC53aWR0aCk7CiAgICAgICAgfQogICAgICAgIGxvZy5kKCJhZGp1c3RtZW50cy54ICIgKyBhZGp1c3RtZW50cy54KTsKCiAgICAgICAgaWYgKHJlc2l6ZVJlY3QueSA8IG1heFJlY3QueSkgewogICAgICAgICAgICBhZGp1c3RtZW50cy55ID0gbWF4UmVjdC55IC0gcmVzaXplUmVjdC55OwogICAgICAgIH0gZWxzZSBpZiAoKHJlc2l6ZVJlY3QueSArIHJlc2l6ZVJlY3QuaGVpZ2h0KSA+IChtYXhSZWN0LnkgKyBtYXhSZWN0LmhlaWdodCkpIHsKICAgICAgICAgICAgYWRqdXN0bWVudHMueSA9IChtYXhSZWN0LnkgKyBtYXhSZWN0LmhlaWdodCkgLSAocmVzaXplUmVjdC55ICsgcmVzaXplUmVjdC5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICBsb2cuZCgiYWRqdXN0bWVudHMueSAiICsgYWRqdXN0bWVudHMueSk7CgogICAgICAgIHJlc2l6ZVJlY3QueCA9IGRlZmF1bHRQb3NpdGlvbi54ICsgcHJvcGVydGllcy5vZmZzZXRYICsgYWRqdXN0bWVudHMueDsKICAgICAgICByZXNpemVSZWN0LnkgPSBkZWZhdWx0UG9zaXRpb24ueSArIHByb3BlcnRpZXMub2Zmc2V0WSArIGFkanVzdG1lbnRzLnk7CiAgICAgICAgcHJpbnRSZWN0KCJhZGp1c3RlZCByZXNpemVSZWN0IiwgcmVzaXplUmVjdCk7CgogICAgICAgIHJldHVybiBhZGp1c3RtZW50czsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNSZWN0Q29udGFpbmVkKGNvbnRhaW5pbmdSZWN0LCBjb250YWluZWRSZWN0KSB7CiAgICAgICAgbG9nLmQoImlzUmVjdENvbnRhaW5lZCIpOwogICAgICAgIHByaW50UmVjdCgiY29udGFpbmluZ1JlY3QiLCBjb250YWluaW5nUmVjdCk7CiAgICAgICAgcHJpbnRSZWN0KCJjb250YWluZWRSZWN0IiwgY29udGFpbmVkUmVjdCk7CiAgICAgICAgcmV0dXJuIChjb250YWluZWRSZWN0LnggPj0gY29udGFpbmluZ1JlY3QueCAmJgogICAgICAgICAgICAoY29udGFpbmVkUmVjdC54ICsgY29udGFpbmVkUmVjdC53aWR0aCkgPD0gKGNvbnRhaW5pbmdSZWN0LnggKyBjb250YWluaW5nUmVjdC53aWR0aCkgJiYKICAgICAgICAgICAgY29udGFpbmVkUmVjdC55ID49IGNvbnRhaW5pbmdSZWN0LnkgJiYKICAgICAgICAgICAgKGNvbnRhaW5lZFJlY3QueSArIGNvbnRhaW5lZFJlY3QuaGVpZ2h0KSA8PSAoY29udGFpbmluZ1JlY3QueSArIGNvbnRhaW5pbmdSZWN0LmhlaWdodCkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBwcmludFJlY3QobGFiZWwsIHJlY3QpIHsKICAgICAgICBsb2cuZChsYWJlbCArCiAgICAgICAgICAgICIgWyIgKyByZWN0LnggKyAiLCIgKyByZWN0LnkgKyAiXSIgKwogICAgICAgICAgICAiLFsiICsgKHJlY3QueCArIHJlY3Qud2lkdGgpICsgIiwiICsgKHJlY3QueSArIHJlY3QuaGVpZ2h0KSArICJdIiArCiAgICAgICAgICAgICIgKCIgKyByZWN0LndpZHRoICsgIngiICsgcmVjdC5oZWlnaHQgKyAiKSIpOwogICAgfQoJCgltcmFpZC5kdW1wTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7CgkJdmFyIG5FdmVudHMgPSBPYmplY3Qua2V5cyhsaXN0ZW5lcnMpLmxlbmd0aDsKCQlsb2cuaSgiZHVtcGluZyBsaXN0ZW5lcnMgKCIgKyBuRXZlbnRzICsgIiBldmVudHMpIik7CgkJZm9yICggdmFyIGV2ZW50IGluIGxpc3RlbmVycykgewoJCQl2YXIgZXZlbnRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnNbZXZlbnRdOwoJCQlsb2cuaSgiICAiICsgZXZlbnQgKyAiIGNvbnRhaW5zICIgKyBldmVudExpc3RlbmVycy5sZW5ndGggKyAiIGxpc3RlbmVycyIpOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50TGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7CgkJCQlsb2cuaSgiICAgICIgKyBldmVudExpc3RlbmVyc1tpXSk7CgkJCX0KCQl9Cgl9OwoJCgljb25zb2xlLmxvZygiTVJBSUQgb2JqZWN0IGxvYWRlZCIpOwoKfSkoKTs=";

    public static final String new_close = "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 AAAASUVORK5CYII=";
    public static final String new_close_pressed = "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 4RT5f02O5nnLDJUQAAAAAElFTkSuQmCC";

    public static final String resize_script = "d2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29uc3QgaW1nTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbWcnKTsKICAgICAgICAgICAgbGV0IGJpZ0ltZ0xpc3QgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWdMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaW1nTGlzdFtpXS5jbGllbnRXaWR0aCA+IDMwKSB7CiAgICAgICAgICAgICAgICAgICAgYmlnSW1nTGlzdC5wdXNoKGltZ0xpc3RbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChiaWdJbWdMaXN0Lmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgbGV0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGJpZ0ltZ0xpc3RbMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod3JhcHBlciwgYmlnSW1nTGlzdFswXSk7CiAgICAgICAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGJpZ0ltZ0xpc3RbMF0pOwogICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOwogICAgICAgICAgICAgICAgd3JhcHBlci5zdHlsZS5tYXhXaWR0aCA9ICcxMDB2dyc7CiAgICAgICAgICAgICAgICBiaWdJbWdMaXN0WzBdLnN0eWxlLndpZHRoID0gJ2F1dG8nOwogICAgICAgICAgICAgICAgYmlnSW1nTGlzdFswXS5zdHlsZS5oZWlnaHQgPSAnMTAwdmgnOwogICAgICAgICAgICAgICAgYmlnSW1nTGlzdFswXS5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7CiAgICAgICAgICAgICAgICBiaWdJbWdMaXN0WzBdLnN0eWxlLmxlZnQgPSAnNTAlJzsKICAgICAgICAgICAgICAgIGJpZ0ltZ0xpc3RbMF0uc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVgoLTUwJSknOwogICAgICAgICAgICB9CiAgICAgICAgfQ==";

    public static final String verification_script = "OyhmdW5jdGlvbihvbWlkR2xvYmFsLCBmYWN0b3J5LCBleHBvcnRzKSB7CiAgLy8gQ29tbW9uSlMgc3VwcG9ydAogIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGV4cG9ydHMubm9kZU5hbWUgIT09ICdzdHJpbmcnKSB7CiAgICBmYWN0b3J5KG9taWRHbG9iYWwsIGV4cG9ydHMpOwoKICAvLyBJZiBuZWl0aGVyIEFNRCBub3IgQ29tbW9uSlMgYXJlIHVzZWQsIGV4cG9ydCB0byBhIHZlcnNpb25lZCBuYW1lIGluIHRoZQogIC8vIGdsb2JhbCBjb250ZXh0LgogIH0gZWxzZSB7CiAgICB2YXIgZXhwb3J0cyA9IHt9OwogICAgZmFjdG9yeShvbWlkR2xvYmFsLCBleHBvcnRzKTsKCiAgICBmdW5jdGlvbiBkZWVwRnJlZXplKG9iamVjdCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICBvYmplY3Rba2V5XSA9IGRlZXBGcmVlemUob2JqZWN0W2tleV0pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gT2JqZWN0LmZyZWV6ZShvYmplY3QpOwogICAgfQoKICAgIC8vIEluamVjdCBhbmQgZnJlZXplIHRoZSBleHBvcnRlZCBjb21wb25lbnRzIG9mIG9taWQuCiAgICBmb3IgKHZhciBrZXkgaW4gZXhwb3J0cykgewogICAgICBpZiAoZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgaWYgKCFPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9taWRHbG9iYWwsIGtleSkpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvbWlkR2xvYmFsLCBrZXksIHsKICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlZXBGcmVlemUoeycxLjAuMi1kZXYnOiBleHBvcnRzW2tleV19KTsKICAgICAgICAgICAgfSwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfSh0eXBlb2YgZ2xvYmFsID09PSAndW5kZWZpbmVkJyA/IHRoaXMgOiBnbG9iYWwsIGZ1bmN0aW9uKG9taWRHbG9iYWwsIG9taWRFeHBvcnRzKSB7CiAgJ3VzZSBzdHJpY3QnO3ZhciAkanNjb21wID0gJGpzY29tcCB8fCB7fTsKJGpzY29tcC5zY29wZSA9IHt9OwokanNjb21wLmluaGVyaXRzID0gZnVuY3Rpb24oYSwgYikgewogIGZ1bmN0aW9uIGMoKSB7CiAgfQogIGMucHJvdG90eXBlID0gYi5wcm90b3R5cGU7CiAgYS5zdXBlckNsYXNzXyA9IGIucHJvdG90eXBlOwogIGEucHJvdG90eXBlID0gbmV3IGM7CiAgYS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBhOwogIGZvciAodmFyIGQgaW4gYikgewogICAgaWYgKCJwcm90b3R5cGUiICE9IGQpIHsKICAgICAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIGUgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGIsIGQpOwogICAgICAgIGUgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGQsIGUpOwogICAgICB9IGVsc2UgewogICAgICAgIGFbZF0gPSBiW2RdOwogICAgICB9CiAgICB9CiAgfQp9OwokanNjb21wLkFTU1VNRV9FUzUgPSAhMTsKJGpzY29tcC5BU1NVTUVfTk9fTkFUSVZFX01BUCA9ICExOwokanNjb21wLkFTU1VNRV9OT19OQVRJVkVfU0VUID0gITE7CiRqc2NvbXAuZGVmaW5lUHJvcGVydHkgPSAkanNjb21wLkFTU1VNRV9FUzUgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkgOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgYSAhPSBBcnJheS5wcm90b3R5cGUgJiYgYSAhPSBPYmplY3QucHJvdG90eXBlICYmIChhW2JdID0gYy52YWx1ZSk7Cn07CiRqc2NvbXAuZ2V0R2xvYmFsID0gZnVuY3Rpb24oYSkgewogIHJldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ICYmIHdpbmRvdyA9PT0gYSA/IGEgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsICYmIG51bGwgIT0gZ2xvYmFsID8gZ2xvYmFsIDogYTsKfTsKJGpzY29tcC5nbG9iYWwgPSAkanNjb21wLmdldEdsb2JhbCh0aGlzKTsKJGpzY29tcC5TWU1CT0xfUFJFRklYID0gImpzY29tcF9zeW1ib2xfIjsKJGpzY29tcC5pbml0U3ltYm9sID0gZnVuY3Rpb24oKSB7CiAgJGpzY29tcC5pbml0U3ltYm9sID0gZnVuY3Rpb24oKSB7CiAgfTsKICAkanNjb21wLmdsb2JhbC5TeW1ib2wgfHwgKCRqc2NvbXAuZ2xvYmFsLlN5bWJvbCA9ICRqc2NvbXAuU3ltYm9sKTsKfTsKJGpzY29tcC5zeW1ib2xDb3VudGVyXyA9IDA7CiRqc2NvbXAuU3ltYm9sID0gZnVuY3Rpb24oYSkgewogIHJldHVybiAkanNjb21wLlNZTUJPTF9QUkVGSVggKyAoYSB8fCAiIikgKyAkanNjb21wLnN5bWJvbENvdW50ZXJfKys7Cn07CiRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yID0gZnVuY3Rpb24oKSB7CiAgJGpzY29tcC5pbml0U3ltYm9sKCk7CiAgdmFyIGEgPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3I7CiAgYSB8fCAoYSA9ICRqc2NvbXAuZ2xvYmFsLlN5bWJvbC5pdGVyYXRvciA9ICRqc2NvbXAuZ2xvYmFsLlN5bWJvbCgiaXRlcmF0b3IiKSk7CiAgImZ1bmN0aW9uIiAhPSB0eXBlb2YgQXJyYXkucHJvdG90eXBlW2FdICYmICRqc2NvbXAuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCBhLCB7Y29uZmlndXJhYmxlOiEwLCB3cml0YWJsZTohMCwgdmFsdWU6ZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gJGpzY29tcC5hcnJheUl0ZXJhdG9yKHRoaXMpOwogIH19KTsKICAkanNjb21wLmluaXRTeW1ib2xJdGVyYXRvciA9IGZ1bmN0aW9uKCkgewogIH07Cn07CiRqc2NvbXAuYXJyYXlJdGVyYXRvciA9IGZ1bmN0aW9uKGEpIHsKICB2YXIgYiA9IDA7CiAgcmV0dXJuICRqc2NvbXAuaXRlcmF0b3JQcm90b3R5cGUoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gYiA8IGEubGVuZ3RoID8ge2RvbmU6ITEsIHZhbHVlOmFbYisrXX0gOiB7ZG9uZTohMH07CiAgfSk7Cn07CiRqc2NvbXAuaXRlcmF0b3JQcm90b3R5cGUgPSBmdW5jdGlvbihhKSB7CiAgJGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IoKTsKICBhID0ge25leHQ6YX07CiAgYVskanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpczsKICB9OwogIHJldHVybiBhOwp9OwokanNjb21wLm1ha2VJdGVyYXRvciA9IGZ1bmN0aW9uKGEpIHsKICAkanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcigpOwogIHZhciBiID0gYVtTeW1ib2wuaXRlcmF0b3JdOwogIHJldHVybiBiID8gYi5jYWxsKGEpIDogJGpzY29tcC5hcnJheUl0ZXJhdG9yKGEpOwp9OwokanNjb21wLmFycmF5RnJvbUl0ZXJhdG9yID0gZnVuY3Rpb24oYSkgewogIGZvciAodmFyIGIsIGMgPSBbXTsgIShiID0gYS5uZXh0KCkpLmRvbmU7KSB7CiAgICBjLnB1c2goYi52YWx1ZSk7CiAgfQogIHJldHVybiBjOwp9OwokanNjb21wLmFycmF5RnJvbUl0ZXJhYmxlID0gZnVuY3Rpb24oYSkgewogIHJldHVybiBhIGluc3RhbmNlb2YgQXJyYXkgPyBhIDogJGpzY29tcC5hcnJheUZyb21JdGVyYXRvcigkanNjb21wLm1ha2VJdGVyYXRvcihhKSk7Cn07CnZhciBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRhcmdzQ2hlY2tlciA9IHthc3NlcnRUcnV0aHlTdHJpbmc6ZnVuY3Rpb24oYSwgYikgewogIGlmICghYikgewogICAgdGhyb3cgRXJyb3IoIlZhbHVlIGZvciAiICsgYSArICIgaXMgdW5kZWZpbmVkLCBudWxsIG9yIGJsYW5rLiIpOwogIH0KICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBiICYmICEoYiBpbnN0YW5jZW9mIFN0cmluZykpIHsKICAgIHRocm93IEVycm9yKCJWYWx1ZSBmb3IgIiArIGEgKyAiIGlzIG5vdCBhIHN0cmluZy4iKTsKICB9CiAgaWYgKCIiID09PSBiLnRyaW0oKSkgewogICAgdGhyb3cgRXJyb3IoIlZhbHVlIGZvciAiICsgYSArICIgaXMgZW1wdHkgc3RyaW5nLiIpOwogIH0KfSwgYXNzZXJ0Tm90TnVsbE9iamVjdDpmdW5jdGlvbihhLCBiKSB7CiAgaWYgKG51bGwgPT0gYikgewogICAgdGhyb3cgRXJyb3IoIlZhbHVlIGZvciAiICsgYSArICIgaXMgdW5kZWZpbmVkIG9yIG51bGwiKTsKICB9Cn0sIGFzc2VydE51bWJlcjpmdW5jdGlvbihhLCBiKSB7CiAgaWYgKG51bGwgPT0gYikgewogICAgdGhyb3cgRXJyb3IoYSArICIgbXVzdCBub3QgYmUgbnVsbCBvciB1bmRlZmluZWQuIik7CiAgfQogIGlmICgibnVtYmVyIiAhPT0gdHlwZW9mIGIgfHwgaXNOYU4oYikpIHsKICAgIHRocm93IEVycm9yKCJWYWx1ZSBmb3IgIiArIGEgKyAiIGlzIG5vdCBhIG51bWJlciIpOwogIH0KfSwgYXNzZXJ0TnVtYmVyQmV0d2VlbjpmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kYXJnc0NoZWNrZXIuYXNzZXJ0TnVtYmVyKShhLCBiKTsKICBpZiAoYiA8IGMgfHwgYiA+IGQpIHsKICAgIHRocm93IEVycm9yKCJWYWx1ZSBmb3IgIiArIGEgKyAiIGlzIG91dHNpZGUgdGhlIHJhbmdlIFsiICsgYyArICIsIiArIGQgKyAiXSIpOwogIH0KfSwgYXNzZXJ0RnVuY3Rpb246ZnVuY3Rpb24oYSwgYikgewogIGlmICghYikgewogICAgdGhyb3cgRXJyb3IoYSArICIgbXVzdCBub3QgYmUgdHJ1dGh5LiIpOwogIH0KfSwgYXNzZXJ0UG9zaXRpdmVOdW1iZXI6ZnVuY3Rpb24oYSwgYikgewogICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGFyZ3NDaGVja2VyLmFzc2VydE51bWJlcikoYSwgYik7CiAgaWYgKDAgPiBiKSB7CiAgICB0aHJvdyBFcnJvcihhICsgIiBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyLiIpOwogIH0KfX07CnZhciBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRWZXJzaW9uVXRpbHMgPSB7fSwgbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJFZlcnNpb25VdGlsc19TRU1WRVJfRElHSVRTX05VTUJFUiA9IDM7Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJFZlcnNpb25VdGlscy5pc1ZhbGlkVmVyc2lvbiA9IGZ1bmN0aW9uKGEpIHsKICByZXR1cm4gL1xkK1wuXGQrXC5cZCsoLS4qKT8vLnRlc3QoYSk7Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJFZlcnNpb25VdGlscy52ZXJzaW9uR3JlYXRlck9yRXF1YWwgPSBmdW5jdGlvbihhLCBiKSB7CiAgYSA9IGEuc3BsaXQoIi0iKVswXS5zcGxpdCgiLiIpOwogIGIgPSBiLnNwbGl0KCItIilbMF0uc3BsaXQoIi4iKTsKICBmb3IgKHZhciBjID0gMDsgYyA8IG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRWZXJzaW9uVXRpbHNfU0VNVkVSX0RJR0lUU19OVU1CRVI7IGMrKykgewogICAgdmFyIGQgPSBwYXJzZUludChhW2NdLCAxMCksIGUgPSBwYXJzZUludChiW2NdLCAxMCk7CiAgICBpZiAoZCA+IGUpIHsKICAgICAgYnJlYWs7CiAgICB9IGVsc2UgewogICAgICBpZiAoZCA8IGUpIHsKICAgICAgICByZXR1cm4gITE7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuICEwOwp9Owp2YXIgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQXJnc1NlckRlID0ge30sIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRBcmdzU2VyRGVfQVJHU19OT1RfU0VSSUFMSVpFRF9WRVJTSU9OID0gIjEuMC4zIjsKbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQXJnc1NlckRlLnNlcmlhbGl6ZU1lc3NhZ2VBcmdzID0gZnVuY3Rpb24oYSwgYikgewogIHJldHVybiAoMCxtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRWZXJzaW9uVXRpbHMuaXNWYWxpZFZlcnNpb24pKGEpICYmICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJFZlcnNpb25VdGlscy52ZXJzaW9uR3JlYXRlck9yRXF1YWwpKGEsIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRBcmdzU2VyRGVfQVJHU19OT1RfU0VSSUFMSVpFRF9WRVJTSU9OKSA/IGIgOiBKU09OLnN0cmluZ2lmeShiKTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQXJnc1NlckRlLmRlc2VyaWFsaXplTWVzc2FnZUFyZ3MgPSBmdW5jdGlvbihhLCBiKSB7CiAgcmV0dXJuICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJFZlcnNpb25VdGlscy5pc1ZhbGlkVmVyc2lvbikoYSkgJiYgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kVmVyc2lvblV0aWxzLnZlcnNpb25HcmVhdGVyT3JFcXVhbCkoYSwgbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEFyZ3NTZXJEZV9BUkdTX05PVF9TRVJJQUxJWkVEX1ZFUlNJT04pID8gYiA/IGIgOiBbXSA6IGIgJiYgInN0cmluZyIgPT09IHR5cGVvZiBiID8gSlNPTi5wYXJzZShiKSA6IFtdOwp9Owp2YXIgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kY29uc3RhbnRzID0ge0FkRXZlbnRUeXBlOntJTVBSRVNTSU9OOiJpbXByZXNzaW9uIiwgU1RBVEVfQ0hBTkdFOiJzdGF0ZUNoYW5nZSIsIEdFT01FVFJZX0NIQU5HRToiZ2VvbWV0cnlDaGFuZ2UiLCBTRVNTSU9OX1NUQVJUOiJzZXNzaW9uU3RhcnQiLCBTRVNTSU9OX0VSUk9SOiJzZXNzaW9uRXJyb3IiLCBTRVNTSU9OX0ZJTklTSDoic2Vzc2lvbkZpbmlzaCIsIFZJREVPOiJ2aWRlbyIsIExPQURFRDoibG9hZGVkIiwgU1RBUlQ6InN0YXJ0IiwgRklSU1RfUVVBUlRJTEU6ImZpcnN0UXVhcnRpbGUiLCBNSURQT0lOVDoibWlkcG9pbnQiLCBUSElSRF9RVUFSVElMRToidGhpcmRRdWFydGlsZSIsIENPTVBMRVRFOiJjb21wbGV0ZSIsIFBBVVNFOiJwYXVzZSIsIFJFU1VNRToicmVzdW1lIiwgQlVGRkVSX1NUQVJUOiJidWZmZXJTdGFydCIsIEJVRkZFUl9GSU5JU0g6ImJ1ZmZlckZpbmlzaCIsIFNLSVBQRUQ6InNraXBwZWQiLCBWT0xVTUVfQ0hBTkdFOiJ2b2x1bWVDaGFuZ2UiLCAKUExBWUVSX1NUQVRFX0NIQU5HRToicGxheWVyU3RhdGVDaGFuZ2UiLCBBRF9VU0VSX0lOVEVSQUNUSU9OOiJhZFVzZXJJbnRlcmFjdGlvbiJ9LCBWaWRlb0V2ZW50VHlwZTp7TE9BREVEOiJsb2FkZWQiLCBTVEFSVDoic3RhcnQiLCBGSVJTVF9RVUFSVElMRToiZmlyc3RRdWFydGlsZSIsIE1JRFBPSU5UOiJtaWRwb2ludCIsIFRISVJEX1FVQVJUSUxFOiJ0aGlyZFF1YXJ0aWxlIiwgQ09NUExFVEU6ImNvbXBsZXRlIiwgUEFVU0U6InBhdXNlIiwgUkVTVU1FOiJyZXN1bWUiLCBCVUZGRVJfU1RBUlQ6ImJ1ZmZlclN0YXJ0IiwgQlVGRkVSX0ZJTklTSDoiYnVmZmVyRmluaXNoIiwgU0tJUFBFRDoic2tpcHBlZCIsIFZPTFVNRV9DSEFOR0U6InZvbHVtZUNoYW5nZSIsIFBMQVlFUl9TVEFURV9DSEFOR0U6InBsYXllclN0YXRlQ2hhbmdlIiwgQURfVVNFUl9JTlRFUkFDVElPTjoiYWRVc2VySW50ZXJhY3Rpb24ifSwgRXJyb3JUeXBlOntHRU5FUklDOiJnZW5lcmljIiwgVklERU86InZpZGVvIn0sIApBZFNlc3Npb25UeXBlOntOQVRJVkU6Im5hdGl2ZSIsIEhUTUw6Imh0bWwifSwgRXZlbnRPd25lcjp7TkFUSVZFOiJuYXRpdmUiLCBKQVZBU0NSSVBUOiJqYXZhc2NyaXB0IiwgTk9ORToibm9uZSJ9LCBBY2Nlc3NNb2RlOntGVUxMOiJmdWxsIiwgTElNSVRFRDoibGltaXRlZCJ9LCBBcHBTdGF0ZTp7QkFDS0dST1VOREVEOiJiYWNrZ3JvdW5kZWQiLCBGT1JFR1JPVU5ERUQ6ImZvcmVncm91bmRlZCJ9LCBFbnZpcm9ubWVudDp7TU9CSUxFOiJhcHAifSwgSW50ZXJhY3Rpb25UeXBlOntDTElDSzoiY2xpY2siLCBJTlZJVEFUSU9OX0FDQ0VQVDoiaW52aXRhdGlvbkFjY2VwdCJ9LCBNZWRpYVR5cGU6e0RJU1BMQVk6ImRpc3BsYXkiLCBWSURFTzoidmlkZW8ifSwgUmVhc29uOntOT1RfRk9VTkQ6Im5vdEZvdW5kIiwgSElEREVOOiJoaWRkZW4iLCBCQUNLR1JPVU5ERUQ6ImJhY2tncm91bmRlZCIsIFZJRVdQT1JUOiJ2aWV3cG9ydCIsIE9CU1RSVUNURUQ6Im9ic3RydWN0ZWQiLCBDTElQUEVEOiJjbGlwcGVkIn0sIApTdXBwb3J0ZWRGZWF0dXJlczp7Q09OVEFJTkVSOiJjbGlkIiwgVklERU86InZsaWQifSwgVmlkZW9Qb3NpdGlvbjp7UFJFUk9MTDoicHJlcm9sbCIsIE1JRFJPTEw6Im1pZHJvbGwiLCBQT1NUUk9MTDoicG9zdHJvbGwiLCBTVEFOREFMT05FOiJzdGFuZGFsb25lIn0sIFZpZGVvUGxheWVyU3RhdGU6e01JTklNSVpFRDoibWluaW1pemVkIiwgQ09MTEFQU0VEOiJjb2xsYXBzZWQiLCBOT1JNQUw6Im5vcm1hbCIsIEVYUEFOREVEOiJleHBhbmRlZCIsIEZVTExTQ1JFRU46ImZ1bGxzY3JlZW4ifSwgTmF0aXZlVmlld0tleXM6e1g6IngiLCBZOiJ5IiwgV0lEVEg6IndpZHRoIiwgSEVJR0hUOiJoZWlnaHQiLCBBRF9TRVNTSU9OX0lEOiJhZFNlc3Npb25JZCIsIElTX0ZSSUVORExZX09CU1RSVUNUSU9OX0ZPUjoiaXNGcmllbmRseU9ic3RydWN0aW9uRm9yIiwgQ0xJUFNfVE9fQk9VTkRTOiJjbGlwc1RvQm91bmRzIiwgQ0hJTERfVklFV1M6ImNoaWxkVmlld3MiLCBFTkRfWDoiZW5kWCIsIEVORF9ZOiJlbmRZIiwgCk9CU1RSVUNUSU9OUzoib2JzdHJ1Y3Rpb25zIn0sIE1lYXN1cmVtZW50U3RhdGVDaGFuZ2VTb3VyY2U6e0NPTlRBSU5FUjoiY29udGFpbmVyIiwgQ1JFQVRJVkU6ImNyZWF0aXZlIn0sIEVsZW1lbnRNYXJrdXA6e09NSURfRUxFTUVOVF9DTEFTU19OQU1FOiJvbWlkLWVsZW1lbnQifSwgQ29tbXVuaWNhdGlvblR5cGU6e05PTkU6Ik5PTkUiLCBESVJFQ1Q6IkRJUkVDVCIsIFBPU1RfTUVTU0FHRToiUE9TVF9NRVNTQUdFIn0sIE9taWRJbXBsZW1lbnRlcjp7T01TREs6Im9tc2RrIn19Owp2YXIgbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9HVUlEX0tFWSA9ICJvbWlkX21lc3NhZ2VfZ3VpZCIsIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfTUVUSE9EX0tFWSA9ICJvbWlkX21lc3NhZ2VfbWV0aG9kIiwgbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9WRVJTSU9OX0tFWSA9ICJvbWlkX21lc3NhZ2VfdmVyc2lvbiIsIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfQVJHU19LRVkgPSAib21pZF9tZXNzYWdlX2FyZ3MiLCBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2UgPSBmdW5jdGlvbihhLCBiLCBjLCBkKSB7CiAgdGhpcy5ndWlkID0gYTsKICB0aGlzLm1ldGhvZCA9IGI7CiAgdGhpcy52ZXJzaW9uID0gYzsKICB0aGlzLmFyZ3MgPSBkOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2UuaXNWYWxpZFNlcmlhbGl6ZWRNZXNzYWdlID0gZnVuY3Rpb24oYSkgewogIHJldHVybiAhIWEgJiYgdm9pZCAwICE9PSBhW21vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfR1VJRF9LRVldICYmIHZvaWQgMCAhPT0gYVttb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlX01FVEhPRF9LRVldICYmIHZvaWQgMCAhPT0gYVttb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlX1ZFUlNJT05fS0VZXSAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGFbbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9HVUlEX0tFWV0gJiYgInN0cmluZyIgPT09IHR5cGVvZiBhW21vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfTUVUSE9EX0tFWV0gJiYgInN0cmluZyIgPT09IHR5cGVvZiBhW21vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfVkVSU0lPTl9LRVldICYmICh2b2lkIDAgPT09IGFbbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9BUkdTX0tFWV0gfHwgCiAgdm9pZCAwICE9PSBhW21vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfQVJHU19LRVldKTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlLmRlc2VyaWFsaXplID0gZnVuY3Rpb24oYSkgewogIHJldHVybiBuZXcgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlKGFbbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9HVUlEX0tFWV0sIGFbbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9NRVRIT0RfS0VZXSwgYVttb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlX1ZFUlNJT05fS0VZXSwgYVttb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlX0FSR1NfS0VZXSk7Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZS5wcm90b3R5cGUuc2VyaWFsaXplID0gZnVuY3Rpb24oKSB7CiAgdmFyIGEgPSB7fTsKICBhID0gKGFbbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9HVUlEX0tFWV0gPSB0aGlzLmd1aWQsIGFbbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZV9NRVRIT0RfS0VZXSA9IHRoaXMubWV0aG9kLCBhW21vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2VfVkVSU0lPTl9LRVldID0gdGhpcy52ZXJzaW9uLCBhKTsKICB2b2lkIDAgIT09IHRoaXMuYXJncyAmJiAoYVttb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlX0FSR1NfS0VZXSA9IHRoaXMuYXJncyk7CiAgcmV0dXJuIGE7Cn07CnZhciBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRDb21tdW5pY2F0aW9uID0gZnVuY3Rpb24oYSkgewogIHRoaXMudG8gPSBhOwogIHRoaXMuY29tbXVuaWNhdGlvblR5cGVfID0gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kY29uc3RhbnRzLkNvbW11bmljYXRpb25UeXBlLk5PTkU7Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJENvbW11bmljYXRpb24ucHJvdG90eXBlLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24oYSwgYikgewp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRDb21tdW5pY2F0aW9uLnByb3RvdHlwZS5oYW5kbGVNZXNzYWdlID0gZnVuY3Rpb24oYSwgYikgewogIGlmICh0aGlzLm9uTWVzc2FnZSkgewogICAgdGhpcy5vbk1lc3NhZ2UoYSwgYik7CiAgfQp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRDb21tdW5pY2F0aW9uLnByb3RvdHlwZS5nZW5lcmF0ZUd1aWQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCIucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbihhKSB7CiAgICB2YXIgYiA9IDE2ICogTWF0aC5yYW5kb20oKSB8IDA7CiAgICBhID0gInkiID09PSBhID8gKGIgJiAzIHwgOCkudG9TdHJpbmcoMTYpIDogYi50b1N0cmluZygxNik7CiAgICByZXR1cm4gYTsKICB9KTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQ29tbXVuaWNhdGlvbi5wcm90b3R5cGUuc2VyaWFsaXplID0gZnVuY3Rpb24oYSkgewogIHJldHVybiBKU09OLnN0cmluZ2lmeShhKTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQ29tbXVuaWNhdGlvbi5wcm90b3R5cGUuZGVzZXJpYWxpemUgPSBmdW5jdGlvbihhKSB7CiAgcmV0dXJuIEpTT04ucGFyc2UoYSk7Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJENvbW11bmljYXRpb24ucHJvdG90eXBlLmlzRGlyZWN0Q29tbXVuaWNhdGlvbiA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLmNvbW11bmljYXRpb25UeXBlXyA9PT0gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kY29uc3RhbnRzLkNvbW11bmljYXRpb25UeXBlLkRJUkVDVDsKfTsKdmFyIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJERldGVjdE9taWQgPSB7T01JRF9QUkVTRU5UX0ZSQU1FX05BTUU6Im9taWRfdjFfcHJlc2VudCIsIGlzT21pZFByZXNlbnQ6ZnVuY3Rpb24oYSkgewogIHRyeSB7CiAgICByZXR1cm4gYS5mcmFtZXMgPyAhIWEuZnJhbWVzW21vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJERldGVjdE9taWQuT01JRF9QUkVTRU5UX0ZSQU1FX05BTUVdIDogITE7CiAgfSBjYXRjaCAoYikgewogICAgcmV0dXJuICExOwogIH0KfSwgZGVjbGFyZU9taWRQcmVzZW5jZTpmdW5jdGlvbihhKSB7CiAgYS5mcmFtZXMgJiYgYS5kb2N1bWVudCAmJiAobW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGV0ZWN0T21pZC5PTUlEX1BSRVNFTlRfRlJBTUVfTkFNRSBpbiBhLmZyYW1lcyB8fCAobnVsbCA9PSBhLmRvY3VtZW50LmJvZHkgJiYgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGV0ZWN0T21pZC5pc011dGF0aW9uT2JzZXJ2ZXJBdmFpbGFibGVfKGEpID8gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGV0ZWN0T21pZC5yZWdpc3Rlck11dGF0aW9uT2JzZXJ2ZXJfKGEpIDogYS5kb2N1bWVudC5ib2R5ID8gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGV0ZWN0T21pZC5hcHBlbmRQcmVzZW5jZUlmcmFtZV8oYSkgOiBhLmRvY3VtZW50LndyaXRlKCc8aWZyYW1lIHN0eWxlPSJkaXNwbGF5Om5vbmUiICcgKyAoJ2lkPSInICsgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGV0ZWN0T21pZC5PTUlEX1BSRVNFTlRfRlJBTUVfTkFNRSArICciJykgKyAoJyBuYW1lPSInICsgCiAgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGV0ZWN0T21pZC5PTUlEX1BSRVNFTlRfRlJBTUVfTkFNRSArICciPicpICsgIjwvaWZyYW1lPiIpKSk7Cn0sIGFwcGVuZFByZXNlbmNlSWZyYW1lXzpmdW5jdGlvbihhKSB7CiAgdmFyIGIgPSBhLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOwogIGIuaWQgPSBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiREZXRlY3RPbWlkLk9NSURfUFJFU0VOVF9GUkFNRV9OQU1FOwogIGIubmFtZSA9IG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJERldGVjdE9taWQuT01JRF9QUkVTRU5UX0ZSQU1FX05BTUU7CiAgYi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogIGEuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiKTsKfSwgaXNNdXRhdGlvbk9ic2VydmVyQXZhaWxhYmxlXzpmdW5jdGlvbihhKSB7CiAgcmV0dXJuICJNdXRhdGlvbk9ic2VydmVyIiBpbiBhOwp9LCByZWdpc3Rlck11dGF0aW9uT2JzZXJ2ZXJfOmZ1bmN0aW9uKGEpIHsKICB2YXIgYiA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKGMpIHsKICAgIGMuZm9yRWFjaChmdW5jdGlvbihjKSB7CiAgICAgICJCT0RZIiA9PT0gYy5hZGRlZE5vZGVzWzBdLm5vZGVOYW1lICYmIChtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiREZXRlY3RPbWlkLmFwcGVuZFByZXNlbmNlSWZyYW1lXyhhKSwgYi5kaXNjb25uZWN0KCkpOwogICAgfSk7CiAgfSk7CiAgYi5vYnNlcnZlKGEuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB7Y2hpbGRMaXN0OiEwfSk7Cn19Owp2YXIgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGlyZWN0Q29tbXVuaWNhdGlvbiA9IGZ1bmN0aW9uKGEpIHsKICBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRDb21tdW5pY2F0aW9uLmNhbGwodGhpcywgYSk7CiAgdGhpcy5jb21tdW5pY2F0aW9uVHlwZV8gPSBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRjb25zdGFudHMuQ29tbXVuaWNhdGlvblR5cGUuRElSRUNUOwogIHRoaXMuaGFuZGxlRXhwb3J0ZWRNZXNzYWdlID0gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGlyZWN0Q29tbXVuaWNhdGlvbi5wcm90b3R5cGUuaGFuZGxlRXhwb3J0ZWRNZXNzYWdlLmJpbmQodGhpcyk7Cn07CiRqc2NvbXAuaW5oZXJpdHMobW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kRGlyZWN0Q29tbXVuaWNhdGlvbiwgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQ29tbXVuaWNhdGlvbik7Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJERpcmVjdENvbW11bmljYXRpb24ucHJvdG90eXBlLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24oYSwgYikgewogIGIgPSB2b2lkIDAgPT09IGIgPyB0aGlzLnRvIDogYjsKICBpZiAoIWIpIHsKICAgIHRocm93IEVycm9yKCJNZXNzYWdlIGRlc3RpbmF0aW9uIG11c3QgYmUgZGVmaW5lZCBhdCBjb25zdHJ1Y3Rpb24gdGltZSBvciB3aGVuIHNlbmRpbmcgdGhlIG1lc3NhZ2UuIik7CiAgfQogIGIuaGFuZGxlRXhwb3J0ZWRNZXNzYWdlKGEuc2VyaWFsaXplKCksIHRoaXMpOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiREaXJlY3RDb21tdW5pY2F0aW9uLnByb3RvdHlwZS5oYW5kbGVFeHBvcnRlZE1lc3NhZ2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlLmlzVmFsaWRTZXJpYWxpemVkTWVzc2FnZShhKSAmJiB0aGlzLmhhbmRsZU1lc3NhZ2UobW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlLmRlc2VyaWFsaXplKGEpLCBiKTsKfTsKdmFyIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGV2ZW50VHlwZWRlZnMgPSB7fTsKdmFyIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGV4cG9ydGVyID0ge307CmZ1bmN0aW9uIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRleHBvcnRlcl9nZXRPbWlkRXhwb3J0cygpIHsKICByZXR1cm4gInVuZGVmaW5lZCIgPT09IHR5cGVvZiBvbWlkRXhwb3J0cyA/IG51bGwgOiBvbWlkRXhwb3J0czsKfQpmdW5jdGlvbiBtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kZXhwb3J0ZXJfZ2V0T3JDcmVhdGVOYW1lKGEsIGIpIHsKICByZXR1cm4gYSAmJiAoYVtiXSB8fCAoYVtiXSA9IHt9KSk7Cn0KbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kZXhwb3J0ZXIucGFja2FnZUV4cG9ydCA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICBpZiAoYyA9IHZvaWQgMCA9PT0gYyA/IG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRleHBvcnRlcl9nZXRPbWlkRXhwb3J0cygpIDogYykgewogICAgYSA9IGEuc3BsaXQoIi4iKSwgYS5zbGljZSgwLCBhLmxlbmd0aCAtIDEpLnJlZHVjZShtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kZXhwb3J0ZXJfZ2V0T3JDcmVhdGVOYW1lLCBjKVthW2EubGVuZ3RoIC0gMV1dID0gYjsKICB9Cn07CnZhciBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRsb2dnZXIgPSB7ZXJyb3I6ZnVuY3Rpb24oYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyArK2MpIHsKICAgIGJbYyAtIDBdID0gYXJndW1lbnRzW2NdOwogIH0KICBtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kbG9nZ2VyX2V4ZWN1dGVMb2coZnVuY3Rpb24oKSB7CiAgICB0aHJvdyBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KEVycm9yLCBbbnVsbF0uY29uY2F0KFsiQ291bGQgbm90IGNvbXBsZXRlIHRoZSB0ZXN0IHN1Y2Nlc3NmdWxseSAtICJdLCAkanNjb21wLmFycmF5RnJvbUl0ZXJhYmxlKGIpKSkpOwogIH0sIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgW10uY29uY2F0KCRqc2NvbXAuYXJyYXlGcm9tSXRlcmFibGUoYikpKTsKICB9KTsKfSwgZGVidWc6ZnVuY3Rpb24oYSkgewogIGZvciAodmFyIGIgPSBbXSwgYyA9IDA7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyArK2MpIHsKICAgIGJbYyAtIDBdID0gYXJndW1lbnRzW2NdOwogIH0KICBtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kbG9nZ2VyX2V4ZWN1dGVMb2coZnVuY3Rpb24oKSB7CiAgfSwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gY29uc29sZS5lcnJvci5hcHBseShjb25zb2xlLCBbXS5jb25jYXQoJGpzY29tcC5hcnJheUZyb21JdGVyYWJsZShiKSkpOwogIH0pOwp9fTsKZnVuY3Rpb24gbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJGxvZ2dlcl9leGVjdXRlTG9nKGEsIGIpIHsKICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGphc21pbmUgJiYgamFzbWluZSA/IGEoKSA6ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgY29uc29sZSAmJiBjb25zb2xlICYmIGNvbnNvbGUuZXJyb3IgJiYgYigpOwp9Cjt2YXIgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kT21pZEdsb2JhbFByb3ZpZGVyID0ge30sIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXJfZ2xvYmFsVGhpcyA9IGV2YWwoInRoaXMiKTsKZnVuY3Rpb24gbW9kdWxlJGNvbnRlbnRzJG9taWQkY29tbW9uJE9taWRHbG9iYWxQcm92aWRlcl9nZXRPbWlkR2xvYmFsKCkgewogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIG9taWRHbG9iYWwgJiYgb21pZEdsb2JhbCkgewogICAgcmV0dXJuIG9taWRHbG9iYWw7CiAgfQogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbCAmJiBnbG9iYWwpIHsKICAgIHJldHVybiBnbG9iYWw7CiAgfQogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHdpbmRvdyAmJiB3aW5kb3cpIHsKICAgIHJldHVybiB3aW5kb3c7CiAgfQogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXJfZ2xvYmFsVGhpcyAmJiBtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kT21pZEdsb2JhbFByb3ZpZGVyX2dsb2JhbFRoaXMpIHsKICAgIHJldHVybiBtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kT21pZEdsb2JhbFByb3ZpZGVyX2dsb2JhbFRoaXM7CiAgfQogIHRocm93IEVycm9yKCJDb3VsZCBub3QgZGV0ZXJtaW5lIGdsb2JhbCBvYmplY3QgY29udGV4dC4iKTsKfQptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXIub21pZEdsb2JhbCA9IG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXJfZ2V0T21pZEdsb2JhbCgpOwp2YXIgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kUG9zdE1lc3NhZ2VDb21tdW5pY2F0aW9uID0gZnVuY3Rpb24oYSwgYikgewogIGIgPSB2b2lkIDAgPT09IGIgPyBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXIub21pZEdsb2JhbCA6IGI7CiAgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kQ29tbXVuaWNhdGlvbi5jYWxsKHRoaXMsIGIpOwogIHZhciBjID0gdGhpczsKICB0aGlzLmNvbW11bmljYXRpb25UeXBlXyA9IG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGNvbnN0YW50cy5Db21tdW5pY2F0aW9uVHlwZS5QT1NUX01FU1NBR0U7CiAgYS5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgZnVuY3Rpb24oYSkgewogICAgaWYgKCJvYmplY3QiID09PSB0eXBlb2YgYS5kYXRhKSB7CiAgICAgIHZhciBiID0gYS5kYXRhOwogICAgICBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRJbnRlcm5hbE1lc3NhZ2UuaXNWYWxpZFNlcmlhbGl6ZWRNZXNzYWdlKGIpICYmIChiID0gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kSW50ZXJuYWxNZXNzYWdlLmRlc2VyaWFsaXplKGIpLCBhLnNvdXJjZSAmJiBjLmhhbmRsZU1lc3NhZ2UoYiwgYS5zb3VyY2UpKTsKICAgIH0KICB9KTsKfTsKJGpzY29tcC5pbmhlcml0cyhtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRQb3N0TWVzc2FnZUNvbW11bmljYXRpb24sIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJENvbW11bmljYXRpb24pOwptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRQb3N0TWVzc2FnZUNvbW11bmljYXRpb24uaXNDb21wYXRpYmxlQ29udGV4dCA9IGZ1bmN0aW9uKGEpIHsKICByZXR1cm4gISEoYSAmJiBhLmFkZEV2ZW50TGlzdGVuZXIgJiYgYS5wb3N0TWVzc2FnZSk7Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJFBvc3RNZXNzYWdlQ29tbXVuaWNhdGlvbi5wcm90b3R5cGUuc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgYiA9IHZvaWQgMCA9PT0gYiA/IHRoaXMudG8gOiBiOwogIGlmICghYikgewogICAgdGhyb3cgRXJyb3IoIk1lc3NhZ2UgZGVzdGluYXRpb24gbXVzdCBiZSBkZWZpbmVkIGF0IGNvbnN0cnVjdGlvbiB0aW1lIG9yIHdoZW4gc2VuZGluZyB0aGUgbWVzc2FnZS4iKTsKICB9CiAgYi5wb3N0TWVzc2FnZShhLnNlcmlhbGl6ZSgpLCAiKiIpOwp9Owp2YXIgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kUmVjdGFuZ2xlID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogIHRoaXMueCA9IGE7CiAgdGhpcy55ID0gYjsKICB0aGlzLndpZHRoID0gYzsKICB0aGlzLmhlaWdodCA9IGQ7Cn07CnZhciBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRzZXJ2aWNlQ29tbXVuaWNhdGlvbiA9IHt9OwpmdW5jdGlvbiBtb2R1bGUkY29udGVudHMkb21pZCRjb21tb24kc2VydmljZUNvbW11bmljYXRpb25fZ2V0VW5vYmZ1c2NhdGVkS2V5KGEsIGIpIHsKICByZXR1cm4gYi5yZWR1Y2UoZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGEgJiYgYVtiXTsKICB9LCBhKTsKfQptb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRzZXJ2aWNlQ29tbXVuaWNhdGlvbi5zdGFydFNlcnZpY2VDb21tdW5pY2F0aW9uID0gZnVuY3Rpb24oYSwgYiwgYykgewogIGMgPSB2b2lkIDAgPT09IGMgPyBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiREZXRlY3RPbWlkLmlzT21pZFByZXNlbnQgOiBjOwogIHJldHVybiAoYiA9IG1vZHVsZSRjb250ZW50cyRvbWlkJGNvbW1vbiRzZXJ2aWNlQ29tbXVuaWNhdGlvbl9nZXRVbm9iZnVzY2F0ZWRLZXkoYSwgYikpID8gbmV3IG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJERpcmVjdENvbW11bmljYXRpb24oYikgOiBhLnRvcCAmJiBjKGEudG9wKSA/IG5ldyBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRQb3N0TWVzc2FnZUNvbW11bmljYXRpb24oYSwgYS50b3ApIDogbnVsbDsKfTsKdmFyIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJFZhc3RQcm9wZXJ0aWVzID0gZnVuY3Rpb24oYSwgYiwgYywgZCkgewogIHRoaXMuaXNTa2lwcGFibGUgPSBhOwogIHRoaXMuc2tpcE9mZnNldCA9IGI7CiAgdGhpcy5pc0F1dG9QbGF5ID0gYzsKICB0aGlzLnBvc2l0aW9uID0gZDsKfTsKdmFyIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJHZlcnNpb24gPSB7QXBpVmVyc2lvbjoiMS4wIiwgVmVyc2lvbjoiMS4xLjAtZGV2In07CnZhciBtb2R1bGUkY29udGVudHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50X1ZFUklGSUNBVElPTl9DTElFTlRfVkVSU0lPTiA9IG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJHZlcnNpb24uVmVyc2lvbiwgbW9kdWxlJGNvbnRlbnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudF9FdmVudENhbGxiYWNrLCBtb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQgPSBmdW5jdGlvbihhKSB7CiAgaWYgKHRoaXMuY29tbXVuaWNhdGlvbiA9IGEgPSB2b2lkIDAgPT09IGEgPyAoMCxtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRzZXJ2aWNlQ29tbXVuaWNhdGlvbi5zdGFydFNlcnZpY2VDb21tdW5pY2F0aW9uKShtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXIub21pZEdsb2JhbCwgWyJvbWlkIiwgInYxX1ZlcmlmaWNhdGlvblNlcnZpY2VDb21tdW5pY2F0aW9uIl0pIDogYSkgewogICAgdGhpcy5jb21tdW5pY2F0aW9uLm9uTWVzc2FnZSA9IHRoaXMuaGFuZGxlTWVzc2FnZV8uYmluZCh0aGlzKTsKICB9CiAgdGhpcy5yZW1vdGVJbnRlcnZhbHNfID0gdGhpcy5yZW1vdGVUaW1lb3V0c18gPSAwOwogIHRoaXMuY2FsbGJhY2tNYXBfID0ge307Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudC5wcm90b3R5cGUuaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gISF0aGlzLmNvbW11bmljYXRpb247Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudC5wcm90b3R5cGUucmVnaXN0ZXJTZXNzaW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbihhLCBiKSB7CiAgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kYXJnc0NoZWNrZXIuYXNzZXJ0RnVuY3Rpb24pKCJmdW5jdGlvblRvRXhlY3V0ZSIsIGEpOwogIHRoaXMuc2VuZE1lc3NhZ2VfKCJhZGRTZXNzaW9uTGlzdGVuZXIiLCBhLCBiKTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oYSwgYikgewogICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGFyZ3NDaGVja2VyLmFzc2VydFRydXRoeVN0cmluZykoImV2ZW50VHlwZSIsIGEpOwogICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGFyZ3NDaGVja2VyLmFzc2VydEZ1bmN0aW9uKSgiZnVuY3Rpb25Ub0V4ZWN1dGUiLCBiKTsKICB0aGlzLnNlbmRNZXNzYWdlXygiYWRkRXZlbnRMaXN0ZW5lciIsIGIsIGEpOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLnNlbmRVcmwgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kYXJnc0NoZWNrZXIuYXNzZXJ0VHJ1dGh5U3RyaW5nKSgidXJsIiwgYSk7CiAgdGhpcy5zZW5kTWVzc2FnZV8oInNlbmRVcmwiLCBmdW5jdGlvbihhKSB7CiAgICBhICYmIGIgPyBiKCkgOiAhYSAmJiBjICYmIGMoKTsKICB9LCBhKTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50LnByb3RvdHlwZS5pbmplY3RKYXZhU2NyaXB0UmVzb3VyY2UgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgdmFyIGQgPSB0aGlzOwogICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGFyZ3NDaGVja2VyLmFzc2VydFRydXRoeVN0cmluZykoInVybCIsIGEpOwogIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJE9taWRHbG9iYWxQcm92aWRlci5vbWlkR2xvYmFsLmRvY3VtZW50ID8gdGhpcy5pbmplY3RKYXZhc2NyaXB0UmVzb3VyY2VVcmxJbkRvbV8oYSwgYiwgYykgOiB0aGlzLnNlbmRNZXNzYWdlXygiaW5qZWN0SmF2YVNjcmlwdFJlc291cmNlIiwgZnVuY3Rpb24oZSwgZikgewogICAgZSA/IChkLmV2YWx1YXRlSmF2YVNjcmlwdF8oZiwgYSksIGIoKSkgOiAobW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kbG9nZ2VyLmVycm9yKCJTZXJ2aWNlIGZhaWxlZCB0byBsb2FkIEphdmFTY3JpcHQgcmVzb3VyY2UuIiksIGMoKSk7CiAgfSwgYSk7Cn07Cm1vZHVsZSRleHBvcnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudC5wcm90b3R5cGUuaW5qZWN0SmF2YXNjcmlwdFJlc291cmNlVXJsSW5Eb21fID0gZnVuY3Rpb24oYSwgYiwgYykgewogIHZhciBkID0gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kT21pZEdsb2JhbFByb3ZpZGVyLm9taWRHbG9iYWwuZG9jdW1lbnQsIGUgPSBkLmJvZHk7CiAgZCA9IGQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgZC5vbmxvYWQgPSBiOwogIGQub25lcnJvciA9IGM7CiAgZC5zcmMgPSBhOwogIGQudHlwZSA9ICJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IjsKICBlLmFwcGVuZENoaWxkKGQpOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLmV2YWx1YXRlSmF2YVNjcmlwdF8gPSBmdW5jdGlvbihhLCBiKSB7CiAgdHJ5IHsKICAgIGV2YWwoYSk7CiAgfSBjYXRjaCAoYykgewogICAgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kbG9nZ2VyLmVycm9yKCdFcnJvciBldmFsdWF0aW5nIHRoZSBKYXZhU2NyaXB0IHJlc291cmNlIGZyb20gIicgKyBiICsgJyIuJyk7CiAgfQp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLnNldFRpbWVvdXQgPSBmdW5jdGlvbihhLCBiKSB7CiAgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kYXJnc0NoZWNrZXIuYXNzZXJ0RnVuY3Rpb24pKCJmdW5jdGlvblRvRXhlY3V0ZSIsIGEpOwogICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGFyZ3NDaGVja2VyLmFzc2VydFBvc2l0aXZlTnVtYmVyKSgidGltZUluTWlsbGlzIiwgYik7CiAgaWYgKHRoaXMuaGFzVGltZW91dE1ldGhvZHNfKCkpIHsKICAgIHJldHVybiBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXIub21pZEdsb2JhbC5zZXRUaW1lb3V0KGEsIGIpOwogIH0KICB2YXIgYyA9IHRoaXMucmVtb3RlVGltZW91dHNfKys7CiAgdGhpcy5zZW5kTWVzc2FnZV8oInNldFRpbWVvdXQiLCBhLCBjLCBiKTsKICByZXR1cm4gYzsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50LnByb3RvdHlwZS5jbGVhclRpbWVvdXQgPSBmdW5jdGlvbihhKSB7CiAgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kYXJnc0NoZWNrZXIuYXNzZXJ0UG9zaXRpdmVOdW1iZXIpKCJ0aW1lb3V0SWQiLCBhKTsKICB0aGlzLmhhc1RpbWVvdXRNZXRob2RzXygpID8gbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kT21pZEdsb2JhbFByb3ZpZGVyLm9taWRHbG9iYWwuY2xlYXJUaW1lb3V0KGEpIDogdGhpcy5zZW5kT25lV2F5TWVzc2FnZV8oImNsZWFyVGltZW91dCIsIGEpOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLnNldEludGVydmFsID0gZnVuY3Rpb24oYSwgYikgewogICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJGFyZ3NDaGVja2VyLmFzc2VydEZ1bmN0aW9uKSgiZnVuY3Rpb25Ub0V4ZWN1dGUiLCBhKTsKICAoMCxtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRhcmdzQ2hlY2tlci5hc3NlcnRQb3NpdGl2ZU51bWJlcikoInRpbWVJbk1pbGxpcyIsIGIpOwogIGlmICh0aGlzLmhhc0ludGVydmFsTWV0aG9kc18oKSkgewogICAgcmV0dXJuIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJE9taWRHbG9iYWxQcm92aWRlci5vbWlkR2xvYmFsLnNldEludGVydmFsKGEsIGIpOwogIH0KICB2YXIgYyA9IHRoaXMucmVtb3RlSW50ZXJ2YWxzXysrOwogIHRoaXMuc2VuZE1lc3NhZ2VfKCJzZXRJbnRlcnZhbCIsIGEsIGMsIGIpOwogIHJldHVybiBjOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLmNsZWFySW50ZXJ2YWwgPSBmdW5jdGlvbihhKSB7CiAgKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kYXJnc0NoZWNrZXIuYXNzZXJ0UG9zaXRpdmVOdW1iZXIpKCJpbnRlcnZhbElkIiwgYSk7CiAgdGhpcy5oYXNJbnRlcnZhbE1ldGhvZHNfKCkgPyBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXIub21pZEdsb2JhbC5jbGVhckludGVydmFsKGEpIDogdGhpcy5zZW5kT25lV2F5TWVzc2FnZV8oImNsZWFySW50ZXJ2YWwiLCBhKTsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50LnByb3RvdHlwZS5oYXNUaW1lb3V0TWV0aG9kc18gPSBmdW5jdGlvbigpIHsKICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJE9taWRHbG9iYWxQcm92aWRlci5vbWlkR2xvYmFsLnNldFRpbWVvdXQgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJE9taWRHbG9iYWxQcm92aWRlci5vbWlkR2xvYmFsLmNsZWFyVGltZW91dDsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50LnByb3RvdHlwZS5oYXNJbnRlcnZhbE1ldGhvZHNfID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRPbWlkR2xvYmFsUHJvdmlkZXIub21pZEdsb2JhbC5zZXRJbnRlcnZhbCAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kT21pZEdsb2JhbFByb3ZpZGVyLm9taWRHbG9iYWwuY2xlYXJJbnRlcnZhbDsKfTsKbW9kdWxlJGV4cG9ydHMkb21pZCR2ZXJpZmljYXRpb25DbGllbnQkVmVyaWZpY2F0aW9uQ2xpZW50LnByb3RvdHlwZS5oYW5kbGVNZXNzYWdlXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICBiID0gYS5tZXRob2Q7CiAgdmFyIGMgPSBhLmd1aWQ7CiAgYSA9IGEuYXJnczsKICBpZiAoInJlc3BvbnNlIiA9PT0gYiAmJiB0aGlzLmNhbGxiYWNrTWFwX1tjXSkgewogICAgdmFyIGQgPSAoMCxtb2R1bGUkZXhwb3J0cyRvbWlkJGNvbW1vbiRBcmdzU2VyRGUuZGVzZXJpYWxpemVNZXNzYWdlQXJncykobW9kdWxlJGNvbnRlbnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudF9WRVJJRklDQVRJT05fQ0xJRU5UX1ZFUlNJT04sIGEpOwogICAgdGhpcy5jYWxsYmFja01hcF9bY10uYXBwbHkodGhpcywgZCk7CiAgfQogICJlcnJvciIgPT09IGIgJiYgd2luZG93LmNvbnNvbGUgJiYgbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kbG9nZ2VyLmVycm9yKGEpOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLnNlbmRPbmVXYXlNZXNzYWdlXyA9IGZ1bmN0aW9uKGEsIGIpIHsKICBmb3IgKHZhciBjID0gW10sIGQgPSAxOyBkIDwgYXJndW1lbnRzLmxlbmd0aDsgKytkKSB7CiAgICBjW2QgLSAxXSA9IGFyZ3VtZW50c1tkXTsKICB9CiAgdGhpcy5zZW5kTWVzc2FnZV8uYXBwbHkodGhpcywgW10uY29uY2F0KFthLCBudWxsXSwgJGpzY29tcC5hcnJheUZyb21JdGVyYWJsZShjKSkpOwp9Owptb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQucHJvdG90eXBlLnNlbmRNZXNzYWdlXyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICBmb3IgKHZhciBkID0gW10sIGUgPSAyOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgKytlKSB7CiAgICBkW2UgLSAyXSA9IGFyZ3VtZW50c1tlXTsKICB9CiAgdGhpcy5pc1N1cHBvcnRlZCgpICYmIChlID0gdGhpcy5jb21tdW5pY2F0aW9uLmdlbmVyYXRlR3VpZCgpLCBiICYmICh0aGlzLmNhbGxiYWNrTWFwX1tlXSA9IGIpLCBkID0gbmV3IG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJEludGVybmFsTWVzc2FnZShlLCAiVmVyaWZpY2F0aW9uU2VydmljZS4iICsgYSwgbW9kdWxlJGNvbnRlbnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudF9WRVJJRklDQVRJT05fQ0xJRU5UX1ZFUlNJT04sICgwLG1vZHVsZSRleHBvcnRzJG9taWQkY29tbW9uJEFyZ3NTZXJEZS5zZXJpYWxpemVNZXNzYWdlQXJncykobW9kdWxlJGNvbnRlbnRzJG9taWQkdmVyaWZpY2F0aW9uQ2xpZW50JFZlcmlmaWNhdGlvbkNsaWVudF9WRVJJRklDQVRJT05fQ0xJRU5UX1ZFUlNJT04sIGQpKSwgdGhpcy5jb21tdW5pY2F0aW9uLnNlbmRNZXNzYWdlKGQpKTsKfTsKKDAsbW9kdWxlJGV4cG9ydHMkb21pZCRjb21tb24kZXhwb3J0ZXIucGFja2FnZUV4cG9ydCkoIk9taWRWZXJpZmljYXRpb25DbGllbnQiLCBtb2R1bGUkZXhwb3J0cyRvbWlkJHZlcmlmaWNhdGlvbkNsaWVudCRWZXJpZmljYXRpb25DbGllbnQpOwoKfSwgdHlwZW9mIGV4cG9ydHMgPT09ICd1bmRlZmluZWQnID8gdW5kZWZpbmVkIDogZXhwb3J0cykpOwoKCmZ1bmN0aW9uIHNlcmlhbGl6ZShvYmosIHByZWZpeCkgewogICAgdmFyIHN0ciA9IFtdLAogICAgICAgIHA7CiAgICBmb3IgKHAgaW4gb2JqKSB7CiAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwKSkgewogICAgICAgICAgICB2YXIgayA9IHByZWZpeCA/IHByZWZpeCArICJbIiArIHAgKyAiXSIgOiBwLAogICAgICAgICAgICAgICAgdiA9IG9ialtwXTsKCiAgICAgICAgICAgIGlmIChwID09PSAidmlkZW9FbGVtZW50IikgeyB2ID0gIkRPTSBWaWRlbyBFbGVtZW50IC0gUHJlc2VudCBidXQgbm90IHBhcnNlZCB0byBhdm9pZCBwYXJzZSBlcnJvciI7IH0KICAgICAgICAgICAgaWYgKHAgPT09ICJzbG90RWxlbWVlbnQiKSB7IHYgPSAiRE9NIFNsb3QgRWxlbWVudCAtIFByZXNlbnQgYnV0IG5vdCBwYXJzZWQgdG8gYXZvaWQgcGFyc2UgZXJyb3IiOyB9CgogICAgICAgICAgICBzdHIucHVzaCgodiAhPT0gbnVsbCAmJiB0eXBlb2YgdiA9PT0gIm9iamVjdCIpID8KICAgICAgICAgICAgICAgIHNlcmlhbGl6ZSh2LCBrKSA6CiAgICAgICAgICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoaykgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodikpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHIuam9pbigiJiIpOwp9CgpmdW5jdGlvbiBmaXJlRXZlbnQoZXZlbnQpIHsKICAgIHZhciBwYXJhbXMgPSBzZXJpYWxpemUoZXZlbnQpLAogICAgICAgIHVybCA9ICJodHRwczovL2NvbXBsaWFuY2VvbXNkay5pYWJ0ZWNobGFiLmNvbS9zZW5kbWVzc2FnZT8iICsgcGFyYW1zOwogICAgZmlyZVVSTCh1cmwpOwp9CgpmdW5jdGlvbiBmaXJlVVJMKHVybCkgewogICAgaWYgKHR5cGVvZiBvbWlkTmF0aXZlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIG9taWROYXRpdmUuc2VuZFVybCh1cmwpOwogICAgfSBlbHNlIHsKICAgICAgICBuZXcgSW1hZ2UoKS5zcmMgPSB1cmw7CiAgICB9Cn0KCjsKKGZ1bmN0aW9uKG9taWRHbG9iYWwpIHsKICAgIHZhciBrZXkgPSBPYmplY3Qua2V5cyhvbWlkR2xvYmFsLk9taWRWZXJpZmljYXRpb25DbGllbnQpWzBdOwogICAgdmFyIHZlcmlmaWNhdGlvbkNsaWVudCA9IG5ldyBvbWlkR2xvYmFsLk9taWRWZXJpZmljYXRpb25DbGllbnRba2V5XSgpOwogICAgZmlyZVVSTCgiaHR0cHM6Ly9jb21wbGlhbmNlb21zZGsuaWFidGVjaGxhYi5jb20vc2VuZG1lc3NhZ2U/dmVyc2lvbj0iICsga2V5KTsKCiAgICBpZiAoIXZlcmlmaWNhdGlvbkNsaWVudC5pc1N1cHBvcnRlZCgpKSB7CiAgICAgICAgZmlyZVVSTCgiaHR0cHM6Ly9jb21wbGlhbmNlb21zZGsuaWFidGVjaGxhYi5jb20vc2VuZG1lc3NhZ2U/c3VwcG9ydGVkPW5vIik7CiAgICAgICAgb21pZEdsb2JhbC5pc09taWRTdXBwb3J0ZWQgPSBmYWxzZTsKICAgICAgICBvbWlkR2xvYmFsLnZlcmlmaWNhdGlvblNjcmlwdExvYWRlZCA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG9taWRHbG9iYWwuaXNPbWlkU3VwcG9ydGVkID0gdHJ1ZTsKICAgIGZpcmVVUkwoImh0dHBzOi8vY29tcGxpYW5jZW9tc2RrLmlhYnRlY2hsYWIuY29tL3NlbmRtZXNzYWdlP3N1cHBvcnRlZD15ZXMiKTsKCiAgICB2ZXJpZmljYXRpb25DbGllbnQucmVnaXN0ZXJTZXNzaW9uT2JzZXJ2ZXIoZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSwgJ2lhYnRlY2hsYWIuY29tLW9taWQnKTsKCiAgICB2ZXJpZmljYXRpb25DbGllbnQuYWRkRXZlbnRMaXN0ZW5lcignaW1wcmVzc2lvbicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZmlyZUV2ZW50KGV2ZW50KTsKICAgIH0pOwoKICAgIHZlcmlmaWNhdGlvbkNsaWVudC5hZGRFdmVudExpc3RlbmVyKCdnZW9tZXRyeUNoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZmlyZUV2ZW50KGV2ZW50KTsKICAgIH0pOwoKICAgIC8vIFZpZGVvIGV2ZW50cwogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZmlyZUV2ZW50KGV2ZW50KTsKICAgIH0pOwoKICAgIHZlcmlmaWNhdGlvbkNsaWVudC5hZGRFdmVudExpc3RlbmVyKCdzdGFydCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZmlyZUV2ZW50KGV2ZW50KTsKICAgIH0pOwoKICAgIHZlcmlmaWNhdGlvbkNsaWVudC5hZGRFdmVudExpc3RlbmVyKCdmaXJzdFF1YXJ0aWxlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21pZHBvaW50JywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RoaXJkUXVhcnRpbGUnLCBmdW5jdGlvbihldmVudCkgewogICAgICAgIGZpcmVFdmVudChldmVudCk7CiAgICB9KTsKCiAgICB2ZXJpZmljYXRpb25DbGllbnQuYWRkRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBmdW5jdGlvbihldmVudCkgewogICAgICAgIGZpcmVFdmVudChldmVudCk7CiAgICB9KTsKCiAgICB2ZXJpZmljYXRpb25DbGllbnQuYWRkRXZlbnRMaXN0ZW5lcigncGF1c2UnLCBmdW5jdGlvbihldmVudCkgewogICAgICAgIGZpcmVFdmVudChldmVudCk7CiAgICB9KTsKCiAgICB2ZXJpZmljYXRpb25DbGllbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVzdW1lJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BsYXllclN0YXRlQ2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3ZvbHVtZUNoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZmlyZUV2ZW50KGV2ZW50KTsKICAgIH0pOwoKICAgIHZlcmlmaWNhdGlvbkNsaWVudC5hZGRFdmVudExpc3RlbmVyKCdza2lwcGVkJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2FkVXNlckludGVyYWN0aW9uJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2J1ZmZlclN0YXJ0JywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBmaXJlRXZlbnQoZXZlbnQpOwogICAgfSk7CgogICAgdmVyaWZpY2F0aW9uQ2xpZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2J1ZmZlckZpbmlzaCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZmlyZUV2ZW50KGV2ZW50KTsKICAgIH0pOwoKICAgIG9taWRHbG9iYWwudmVyaWZpY2F0aW9uU2NyaXB0TG9hZGVkID0gdHJ1ZTsKfSkuY2FsbCh0aGlzLCB0aGlzKTsK";

    public static Drawable getDrawableFromBase64(Resources resources, String encodedString) {
        byte[] decodedString = Base64.decode(encodedString, Base64.DEFAULT);
        Bitmap bitmap = BitmapFactory.decodeByteArray(decodedString, 0, decodedString.length);
        return new BitmapDrawable(resources, bitmap);
    }
}
